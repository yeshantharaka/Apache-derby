<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_66) on Mon Jul 03 23:05:22 IST 2017 -->
<title>BTreeLockingPolicy (Apache Derby V10.13 Internals)</title>
<meta name="date" content="2017-07-03">
<link rel="stylesheet" type="text/css" href="../../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="BTreeLockingPolicy (Apache Derby V10.13 Internals)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":6,"i1":6,"i2":6,"i3":6,"i4":6,"i5":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTreeForwardScan.html" title="class in org.apache.derby.impl.store.access.btree"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTreeMaxScan.html" title="class in org.apache.derby.impl.store.access.btree"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../index.html?org/apache/derby/impl/store/access/btree/BTreeLockingPolicy.html" target="_top">Frames</a></li>
<li><a href="BTreeLockingPolicy.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.derby.impl.store.access.btree</div>
<h2 title="Interface BTreeLockingPolicy" class="title">Interface BTreeLockingPolicy</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Known Implementing Classes:</dt>
<dd><a href="../../../../../../../org/apache/derby/impl/store/access/btree/index/B2INoLocking.html" title="class in org.apache.derby.impl.store.access.btree.index">B2INoLocking</a>, <a href="../../../../../../../org/apache/derby/impl/store/access/btree/index/B2IRowLocking1.html" title="class in org.apache.derby.impl.store.access.btree.index">B2IRowLocking1</a>, <a href="../../../../../../../org/apache/derby/impl/store/access/btree/index/B2IRowLocking2.html" title="class in org.apache.derby.impl.store.access.btree.index">B2IRowLocking2</a>, <a href="../../../../../../../org/apache/derby/impl/store/access/btree/index/B2IRowLocking3.html" title="class in org.apache.derby.impl.store.access.btree.index">B2IRowLocking3</a>, <a href="../../../../../../../org/apache/derby/impl/store/access/btree/index/B2IRowLockingRR.html" title="class in org.apache.derby.impl.store.access.btree.index">B2IRowLockingRR</a>, <a href="../../../../../../../org/apache/derby/impl/store/access/btree/index/B2ITableLocking3.html" title="class in org.apache.derby.impl.store.access.btree.index">B2ITableLocking3</a></dd>
</dl>
<hr>
<br>
<pre>public interface <span class="typeNameLabel">BTreeLockingPolicy</span></pre>
<div class="block">The generic.BTree directory wants to know as little about locking as possible,
in order to make the code usuable by multiple implementations.  But the 
generic code will make calls to abstract lock calls implemented by concrete
btree implementations.  Concrete implementations like B2I understand locking,
and needs informatation specific to the implementation to make the lock calls.
<p>
This class is created and owned by the concrete application, but is passed
into and returned from the generic code when lock calls are made.
Concrete implementations which do not need lock calls can just pass a null
pointer where a BTreeLockingPolicy is requested.
<p>
There are 2 types of lock interfaces, lockScan*() and lockNonScan*().
<p>
The lockScan*() interfaces save the key for the current scan position before
giving up the latch on the page if they have to wait for a row lock. The
callers can reposition the scan using the saved key by calling
<code>BTreeScan.reposition()</code> if such a situation occurs. Then the latches
are reobtained, possibly on a different page if the current key has been moved
to another page in the meantime. Upon return from these interfaces
the row lock requested is guaranteed to have been obtained on the correct
key for the row requested.  These interfaces handle the special case of 
unique indexes where the RowLocation can change while waiting on the lock 
(see implementation for details), basically the lock is retryed after waiting
if the RowLocation has changed.
<p>
The lockNonScan*() interfaces do not save the current scan position. If these
routines return that the latch was released while waiting to obtain the
lock, then the caller must requeue the lock request after taking appropriate
action.  This action usually involves researching the tree to make sure 
that the correct key is locked with latches held. These interfaces
do not handle the special case of unique indexes where the RowLocation can 
change while waiting on the lock, as the row may disappear when the latch
is released to wait on the lock - thus it is necessary that the caller retry
the lock if the interface returns that the latch was released.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTreeLockingPolicy.html#lockNonScanPreviousRow-org.apache.derby.impl.store.access.btree.LeafControlRow-int-org.apache.derby.iapi.store.raw.FetchDescriptor-org.apache.derby.iapi.types.DataValueDescriptor:A-org.apache.derby.iapi.types.RowLocation-org.apache.derby.impl.store.access.btree.OpenBTree-int-int-">lockNonScanPreviousRow</a></span>(<a href="../../../../../../../org/apache/derby/impl/store/access/btree/LeafControlRow.html" title="class in org.apache.derby.impl.store.access.btree">LeafControlRow</a>&nbsp;current_leaf,
                      int&nbsp;current_slot,
                      <a href="../../../../../../../org/apache/derby/iapi/store/raw/FetchDescriptor.html" title="class in org.apache.derby.iapi.store.raw">FetchDescriptor</a>&nbsp;lock_fetch_desc,
                      <a href="../../../../../../../org/apache/derby/iapi/types/DataValueDescriptor.html" title="interface in org.apache.derby.iapi.types">DataValueDescriptor</a>[]&nbsp;lock_template,
                      <a href="../../../../../../../org/apache/derby/iapi/types/RowLocation.html" title="interface in org.apache.derby.iapi.types">RowLocation</a>&nbsp;lock_row_loc,
                      <a href="../../../../../../../org/apache/derby/impl/store/access/btree/OpenBTree.html" title="class in org.apache.derby.impl.store.access.btree">OpenBTree</a>&nbsp;open_btree,
                      int&nbsp;lock_operation,
                      int&nbsp;lock_duration)</code>
<div class="block">Lock the previous key.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTreeLockingPolicy.html#lockNonScanRow-org.apache.derby.impl.store.access.btree.BTree-org.apache.derby.impl.store.access.btree.LeafControlRow-org.apache.derby.impl.store.access.btree.LeafControlRow-org.apache.derby.iapi.types.DataValueDescriptor:A-int-">lockNonScanRow</a></span>(<a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTree.html" title="class in org.apache.derby.impl.store.access.btree">BTree</a>&nbsp;btree,
              <a href="../../../../../../../org/apache/derby/impl/store/access/btree/LeafControlRow.html" title="class in org.apache.derby.impl.store.access.btree">LeafControlRow</a>&nbsp;current_leaf,
              <a href="../../../../../../../org/apache/derby/impl/store/access/btree/LeafControlRow.html" title="class in org.apache.derby.impl.store.access.btree">LeafControlRow</a>&nbsp;aux_leaf,
              <a href="../../../../../../../org/apache/derby/iapi/types/DataValueDescriptor.html" title="interface in org.apache.derby.iapi.types">DataValueDescriptor</a>[]&nbsp;current_row,
              int&nbsp;lock_operation)</code>
<div class="block">Lock a btree row (row in memory).</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTreeLockingPolicy.html#lockNonScanRowOnPage-org.apache.derby.impl.store.access.btree.LeafControlRow-int-org.apache.derby.iapi.store.raw.FetchDescriptor-org.apache.derby.iapi.types.DataValueDescriptor:A-org.apache.derby.iapi.types.RowLocation-int-">lockNonScanRowOnPage</a></span>(<a href="../../../../../../../org/apache/derby/impl/store/access/btree/LeafControlRow.html" title="class in org.apache.derby.impl.store.access.btree">LeafControlRow</a>&nbsp;leaf,
                    int&nbsp;slot,
                    <a href="../../../../../../../org/apache/derby/iapi/store/raw/FetchDescriptor.html" title="class in org.apache.derby.iapi.store.raw">FetchDescriptor</a>&nbsp;lock_fetch_desc,
                    <a href="../../../../../../../org/apache/derby/iapi/types/DataValueDescriptor.html" title="interface in org.apache.derby.iapi.types">DataValueDescriptor</a>[]&nbsp;lock_template,
                    <a href="../../../../../../../org/apache/derby/iapi/types/RowLocation.html" title="interface in org.apache.derby.iapi.types">RowLocation</a>&nbsp;lock_row_loc,
                    int&nbsp;lock_operation)</code>
<div class="block">Lock the row at the given slot.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTreeLockingPolicy.html#lockScanCommittedDeletedRow-org.apache.derby.impl.store.access.btree.OpenBTree-org.apache.derby.impl.store.access.btree.LeafControlRow-org.apache.derby.iapi.types.DataValueDescriptor:A-org.apache.derby.iapi.store.raw.FetchDescriptor-int-">lockScanCommittedDeletedRow</a></span>(<a href="../../../../../../../org/apache/derby/impl/store/access/btree/OpenBTree.html" title="class in org.apache.derby.impl.store.access.btree">OpenBTree</a>&nbsp;open_btree,
                           <a href="../../../../../../../org/apache/derby/impl/store/access/btree/LeafControlRow.html" title="class in org.apache.derby.impl.store.access.btree">LeafControlRow</a>&nbsp;leaf,
                           <a href="../../../../../../../org/apache/derby/iapi/types/DataValueDescriptor.html" title="interface in org.apache.derby.iapi.types">DataValueDescriptor</a>[]&nbsp;template,
                           <a href="../../../../../../../org/apache/derby/iapi/store/raw/FetchDescriptor.html" title="class in org.apache.derby.iapi.store.raw">FetchDescriptor</a>&nbsp;lock_fetch_desc,
                           int&nbsp;slot_no)</code>
<div class="block">Lock a btree row to determine if it is a committed deleted row.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTreeLockingPolicy.html#lockScanRow-org.apache.derby.impl.store.access.btree.OpenBTree-org.apache.derby.impl.store.access.btree.BTreeRowPosition-org.apache.derby.iapi.store.raw.FetchDescriptor-org.apache.derby.iapi.types.DataValueDescriptor:A-org.apache.derby.iapi.types.RowLocation-boolean-boolean-int-">lockScanRow</a></span>(<a href="../../../../../../../org/apache/derby/impl/store/access/btree/OpenBTree.html" title="class in org.apache.derby.impl.store.access.btree">OpenBTree</a>&nbsp;open_btree,
           <a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTreeRowPosition.html" title="class in org.apache.derby.impl.store.access.btree">BTreeRowPosition</a>&nbsp;pos,
           <a href="../../../../../../../org/apache/derby/iapi/store/raw/FetchDescriptor.html" title="class in org.apache.derby.iapi.store.raw">FetchDescriptor</a>&nbsp;lock_fetch_desc,
           <a href="../../../../../../../org/apache/derby/iapi/types/DataValueDescriptor.html" title="interface in org.apache.derby.iapi.types">DataValueDescriptor</a>[]&nbsp;lock_template,
           <a href="../../../../../../../org/apache/derby/iapi/types/RowLocation.html" title="interface in org.apache.derby.iapi.types">RowLocation</a>&nbsp;lock_row_loc,
           boolean&nbsp;previous_key_lock,
           boolean&nbsp;forUpdate,
           int&nbsp;lock_operation)</code>
<div class="block">Lock a row as part of doing the scan.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTreeLockingPolicy.html#unlockScanRecordAfterRead-org.apache.derby.impl.store.access.btree.BTreeRowPosition-boolean-">unlockScanRecordAfterRead</a></span>(<a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTreeRowPosition.html" title="class in org.apache.derby.impl.store.access.btree">BTreeRowPosition</a>&nbsp;pos,
                         boolean&nbsp;forUpdate)</code>
<div class="block">Release read lock on a row.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="lockScanCommittedDeletedRow-org.apache.derby.impl.store.access.btree.OpenBTree-org.apache.derby.impl.store.access.btree.LeafControlRow-org.apache.derby.iapi.types.DataValueDescriptor:A-org.apache.derby.iapi.store.raw.FetchDescriptor-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>lockScanCommittedDeletedRow</h4>
<pre>boolean&nbsp;lockScanCommittedDeletedRow(<a href="../../../../../../../org/apache/derby/impl/store/access/btree/OpenBTree.html" title="class in org.apache.derby.impl.store.access.btree">OpenBTree</a>&nbsp;open_btree,
                                    <a href="../../../../../../../org/apache/derby/impl/store/access/btree/LeafControlRow.html" title="class in org.apache.derby.impl.store.access.btree">LeafControlRow</a>&nbsp;leaf,
                                    <a href="../../../../../../../org/apache/derby/iapi/types/DataValueDescriptor.html" title="interface in org.apache.derby.iapi.types">DataValueDescriptor</a>[]&nbsp;template,
                                    <a href="../../../../../../../org/apache/derby/iapi/store/raw/FetchDescriptor.html" title="class in org.apache.derby.iapi.store.raw">FetchDescriptor</a>&nbsp;lock_fetch_desc,
                                    int&nbsp;slot_no)
                             throws <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Lock a btree row to determine if it is a committed deleted row.
 <p>
 Request an exclusive lock on the row located at the given slot, NOWAIT.
 Return true if the lock is granted, otherwise false.
 <p></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>open_btree</code> - The conglomerate we are locking.</dd>
<dd><code>leaf</code> - The leaf page with the row to lock.</dd>
<dd><code>template</code> - Empty full template row, to read row into.</dd>
<dd><code>slot_no</code> - The slot of row on "current_leaf"</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - Standard exception policy.</dd>
</dl>
</li>
</ul>
<a name="lockScanRow-org.apache.derby.impl.store.access.btree.OpenBTree-org.apache.derby.impl.store.access.btree.BTreeRowPosition-org.apache.derby.iapi.store.raw.FetchDescriptor-org.apache.derby.iapi.types.DataValueDescriptor:A-org.apache.derby.iapi.types.RowLocation-boolean-boolean-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>lockScanRow</h4>
<pre>boolean&nbsp;lockScanRow(<a href="../../../../../../../org/apache/derby/impl/store/access/btree/OpenBTree.html" title="class in org.apache.derby.impl.store.access.btree">OpenBTree</a>&nbsp;open_btree,
                    <a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTreeRowPosition.html" title="class in org.apache.derby.impl.store.access.btree">BTreeRowPosition</a>&nbsp;pos,
                    <a href="../../../../../../../org/apache/derby/iapi/store/raw/FetchDescriptor.html" title="class in org.apache.derby.iapi.store.raw">FetchDescriptor</a>&nbsp;lock_fetch_desc,
                    <a href="../../../../../../../org/apache/derby/iapi/types/DataValueDescriptor.html" title="interface in org.apache.derby.iapi.types">DataValueDescriptor</a>[]&nbsp;lock_template,
                    <a href="../../../../../../../org/apache/derby/iapi/types/RowLocation.html" title="interface in org.apache.derby.iapi.types">RowLocation</a>&nbsp;lock_row_loc,
                    boolean&nbsp;previous_key_lock,
                    boolean&nbsp;forUpdate,
                    int&nbsp;lock_operation)
             throws <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Lock a row as part of doing the scan.
 <p>
 Lock the row at the given slot (or the previous row if slot is 0).
 <p>
 If this routine returns true all locks were acquired while maintaining
 the latch on leaf.  If this routine returns false, locks may or may
 not have been acquired, and the routine should be called again after
 the client has researched the tree to reget the latch on the 
 appropriate page.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>open_btree</code> - The open_btree to associate latches with - 
                          used if routine has to scan backward.</dd>
<dd><code>pos</code> - Description of position of row to lock.</dd>
<dd><code>lock_template</code> - A scratch area to use to read in rows.</dd>
<dd><code>previous_key_lock</code> - Is this a previous key lock call?</dd>
<dd><code>forUpdate</code> - Is the scan for update or for read only.</dd>
<dd><code>lock_operation</code> - For what operation are we requesting the lock, 
                          this should be one of the following 4 options:
                          LOCK_READ [read lock], 
                          (LOCK_INS | LOCK_UPD) [ lock for insert], 
                          (LOCK_INSERT_PREVKEY | LOCK_UPD) [lock for 
                          previous key to insert],
                          (LOCK_UPD) [lock for delete or replace]</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>Whether locks were acquired without releasing latch on leaf.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - Standard exception policy.</dd>
</dl>
</li>
</ul>
<a name="unlockScanRecordAfterRead-org.apache.derby.impl.store.access.btree.BTreeRowPosition-boolean-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>unlockScanRecordAfterRead</h4>
<pre>void&nbsp;unlockScanRecordAfterRead(<a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTreeRowPosition.html" title="class in org.apache.derby.impl.store.access.btree">BTreeRowPosition</a>&nbsp;pos,
                               boolean&nbsp;forUpdate)
                        throws <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Release read lock on a row.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>pos</code> - Data structure that defines the current position
                          in the scan to be unlocked.</dd>
<dd><code>forUpdate</code> - Is the scan for update or for read only.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - Standard exception policy.</dd>
</dl>
</li>
</ul>
<a name="lockNonScanPreviousRow-org.apache.derby.impl.store.access.btree.LeafControlRow-int-org.apache.derby.iapi.store.raw.FetchDescriptor-org.apache.derby.iapi.types.DataValueDescriptor:A-org.apache.derby.iapi.types.RowLocation-org.apache.derby.impl.store.access.btree.OpenBTree-int-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>lockNonScanPreviousRow</h4>
<pre>boolean&nbsp;lockNonScanPreviousRow(<a href="../../../../../../../org/apache/derby/impl/store/access/btree/LeafControlRow.html" title="class in org.apache.derby.impl.store.access.btree">LeafControlRow</a>&nbsp;current_leaf,
                               int&nbsp;current_slot,
                               <a href="../../../../../../../org/apache/derby/iapi/store/raw/FetchDescriptor.html" title="class in org.apache.derby.iapi.store.raw">FetchDescriptor</a>&nbsp;lock_fetch_desc,
                               <a href="../../../../../../../org/apache/derby/iapi/types/DataValueDescriptor.html" title="interface in org.apache.derby.iapi.types">DataValueDescriptor</a>[]&nbsp;lock_template,
                               <a href="../../../../../../../org/apache/derby/iapi/types/RowLocation.html" title="interface in org.apache.derby.iapi.types">RowLocation</a>&nbsp;lock_row_loc,
                               <a href="../../../../../../../org/apache/derby/impl/store/access/btree/OpenBTree.html" title="class in org.apache.derby.impl.store.access.btree">OpenBTree</a>&nbsp;open_btree,
                               int&nbsp;lock_operation,
                               int&nbsp;lock_duration)
                        throws <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Lock the previous key.
 <p>
 Given the current latched page and slot number, lock the logically
 previous key in the table.  There are 3 cases:
 <p>
 slotnumber &gt; 1                       - just lock (slotnumber - 1)
 (slotnumber == 1) &amp;&amp; (leftmost leaf) - this is the first key in the
                                        table, so lock a "magic" FIRSTKEY.
 (slotnumber == 1) &amp;&amp; !(leftmost leaf)- traverse left in the tree looking
                                        for a previous key.
 <p>
 On successful return from this routine appropriate locking will have
 been done.  All locks and latches are requested nowait, if any 
 lock/latch cannot be granted this routine releases the current_leaf
 latch and any latches it may have acquired and returns "false."
 <p>
 All extra latches that may have been gotten will have been released.
 <p>
 This routine will find the "previous row" to the (current_leaf,
 current_slot), walking left in the tree as necessary, and first request
 the lock on that row NOWAIT.  If that lock can not be granted,
 then it will release all latches that it has acquired up to that point
 including the latched current_leaf passed into the routine, and request 
 the lock WAIT.  Once the lock has been granted the routine will return
 and it is up to the caller to research the tree to find where the
 current position may have ended up.  For instance in the case of insert
 once the current latch is released, the correct page to do the insert
 may no longer be where the original scan found it.
 <p>
 If routine returns true, lock was granted NOWAIT, current leaf
 remains latched, and was never unlatched.  If routine returns false,
 lock was granted WAIT, current leaf is not latched, row may have 
 moved in the btree so caller must research to find the row.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>current_leaf</code> - Latched current leaf where "current" key is.</dd>
<dd><code>current_slot</code> - The slot of row on "current_leaf"</dd>
<dd><code>lock_template</code> - Empty full template row, to read row into.</dd>
<dd><code>open_btree</code> - The open_btree to associate latches with - 
                          used if routine has to scan backward.</dd>
<dd><code>lock_operation</code> - For what operation are we requesting the lock, 
                          this should be one of the following 4 options:
                          LOCK_READ [read lock], 
                          (LOCK_INS | LOCK_UPD) [ lock for insert], 
                          (LOCK_INSERT_PREVKEY | LOCK_UPD) [lock for 
                          previous key to insert],
                          (LOCK_UPD) [lock for delete or replace]</dd>
<dd><code>lock_duration</code> - For what duration should the lock be held,
                          if INSTANT_DURATION, then the routine will
                          guarantee that lock was acquired while holding
                          the latch, but then immediately release the
                          lock.  If COMMIT_DURATION or MANUAL_DURATION
                          then the lock be held when routine returns
                          successfully.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - Standard exception policy.</dd>
</dl>
</li>
</ul>
<a name="lockNonScanRow-org.apache.derby.impl.store.access.btree.BTree-org.apache.derby.impl.store.access.btree.LeafControlRow-org.apache.derby.impl.store.access.btree.LeafControlRow-org.apache.derby.iapi.types.DataValueDescriptor:A-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>lockNonScanRow</h4>
<pre>boolean&nbsp;lockNonScanRow(<a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTree.html" title="class in org.apache.derby.impl.store.access.btree">BTree</a>&nbsp;btree,
                       <a href="../../../../../../../org/apache/derby/impl/store/access/btree/LeafControlRow.html" title="class in org.apache.derby.impl.store.access.btree">LeafControlRow</a>&nbsp;current_leaf,
                       <a href="../../../../../../../org/apache/derby/impl/store/access/btree/LeafControlRow.html" title="class in org.apache.derby.impl.store.access.btree">LeafControlRow</a>&nbsp;aux_leaf,
                       <a href="../../../../../../../org/apache/derby/iapi/types/DataValueDescriptor.html" title="interface in org.apache.derby.iapi.types">DataValueDescriptor</a>[]&nbsp;current_row,
                       int&nbsp;lock_operation)
                throws <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Lock a btree row (row in memory).  Meant to be used if caller 
 has the entire row objectified.
 <p>
 Lock a btree row, enforcing the standard lock/latch protocol.  
 On return the row is locked.  Return status indicates if the lock
 was waited for, which will mean a latch was dropped while waiting.
 In general a false status means that the caller will either have 
 to research the tree unless some protocol has been implemented that
 insures that the row will not have moved while the latch was dropped.
 <p>
 This routine request a row lock NOWAIT on the in-memory row 
 "current_row.".  If the lock is granted the routine will return true.
 If the lock cannot be granted NOWAIT, then the routine will release
 the latch on "current_leaf" (if current_leaf is non-null) and 
 "aux_leaf" (if aux_leaf is non-null), and then it will request a WAIT 
 lock on the row.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>btree</code> - The conglomerate we are locking.</dd>
<dd><code>current_leaf</code> - If non-null, this leaf is unlatched if the 
                          routine has to wait on the lock.</dd>
<dd><code>aux_leaf</code> - If non-null, this leaf is unlatched if the 
                          routine has to wait on the lock.</dd>
<dd><code>current_row</code> - In memory, objectified "current" row.</dd>
<dd><code>lock_operation</code> - For what operation are we requesting the lock, 
                          this should be one of the following 4 options:
                          LOCK_READ [read lock], 
                          (LOCK_INS | LOCK_UPD) [ lock for insert], 
                          (LOCK_INSERT_PREVKEY | LOCK_UPD) [lock for 
                          previous key to insert],
                          (LOCK_UPD) [lock for delete or replace]</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - Standard exception policy.</dd>
</dl>
</li>
</ul>
<a name="lockNonScanRowOnPage-org.apache.derby.impl.store.access.btree.LeafControlRow-int-org.apache.derby.iapi.store.raw.FetchDescriptor-org.apache.derby.iapi.types.DataValueDescriptor:A-org.apache.derby.iapi.types.RowLocation-int-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>lockNonScanRowOnPage</h4>
<pre>boolean&nbsp;lockNonScanRowOnPage(<a href="../../../../../../../org/apache/derby/impl/store/access/btree/LeafControlRow.html" title="class in org.apache.derby.impl.store.access.btree">LeafControlRow</a>&nbsp;leaf,
                             int&nbsp;slot,
                             <a href="../../../../../../../org/apache/derby/iapi/store/raw/FetchDescriptor.html" title="class in org.apache.derby.iapi.store.raw">FetchDescriptor</a>&nbsp;lock_fetch_desc,
                             <a href="../../../../../../../org/apache/derby/iapi/types/DataValueDescriptor.html" title="interface in org.apache.derby.iapi.types">DataValueDescriptor</a>[]&nbsp;lock_template,
                             <a href="../../../../../../../org/apache/derby/iapi/types/RowLocation.html" title="interface in org.apache.derby.iapi.types">RowLocation</a>&nbsp;lock_row_loc,
                             int&nbsp;lock_operation)
                      throws <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Lock the row at the given slot.
 <p>
 If this routine returns true all locks were acquired while maintaining
 the latch on leaf.  If this routine returns false, locks may or may
 not have been acquired, and the routine should be called again after
 the client has researched the tree to reget the latch on the 
 appropriate page.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>leaf</code> - The control row of the current leaf to lock.</dd>
<dd><code>slot</code> - The slot position of the row to lock.</dd>
<dd><code>lock_template</code> - A scratch area to use to read in rows.</dd>
<dd><code>lock_operation</code> - For what operation are we requesting the lock, 
                          this should be one of the following 4 options:
                          LOCK_READ [read lock], 
                          (LOCK_INS | LOCK_UPD) [ lock for insert], 
                          (LOCK_INSERT_PREVKEY | LOCK_UPD) [lock for 
                          previous key to insert],
                          (LOCK_UPD) [lock for delete or replace]</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>Whether locks were acquired without releasing latch on leaf.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - Standard exception policy.</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage">Built on Mon 2017-07-03 23:03:59+0530, from revision Unversioned directory</div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTreeForwardScan.html" title="class in org.apache.derby.impl.store.access.btree"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../../org/apache/derby/impl/store/access/btree/BTreeMaxScan.html" title="class in org.apache.derby.impl.store.access.btree"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../index.html?org/apache/derby/impl/store/access/btree/BTreeLockingPolicy.html" target="_top">Frames</a></li>
<li><a href="BTreeLockingPolicy.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Apache Derby V10.13 Internals - <i>Copyright &copy; 2004,2016 The Apache Software Foundation. All Rights Reserved.</i></small></p>
</body>
</html>
