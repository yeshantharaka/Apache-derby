<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_66) on Mon Jul 03 23:05:05 IST 2017 -->
<title>AsynchronousLogShipper (Apache Derby V10.13 Internals)</title>
<meta name="date" content="2017-07-03">
<link rel="stylesheet" type="text/css" href="../../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="AsynchronousLogShipper (Apache Derby V10.13 Internals)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10,"i7":10,"i8":10,"i9":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../../../../org/apache/derby/impl/store/replication/master/LogShipper.html" title="interface in org.apache.derby.impl.store.replication.master"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../index.html?org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html" target="_top">Frames</a></li>
<li><a href="AsynchronousLogShipper.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.classes.inherited.from.class.java.lang.Thread">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.derby.impl.store.replication.master</div>
<h2 title="Class AsynchronousLogShipper" class="title">Class AsynchronousLogShipper</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>java.lang.Thread</li>
<li>
<ul class="inheritance">
<li>org.apache.derby.impl.store.replication.master.AsynchronousLogShipper</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd>java.lang.Runnable, <a href="../../../../../../../org/apache/derby/impl/store/replication/master/LogShipper.html" title="interface in org.apache.derby.impl.store.replication.master">LogShipper</a></dd>
</dl>
<hr>
<br>
<pre>public class <span class="typeNameLabel">AsynchronousLogShipper</span>
extends java.lang.Thread
implements <a href="../../../../../../../org/apache/derby/impl/store/replication/master/LogShipper.html" title="interface in org.apache.derby.impl.store.replication.master">LogShipper</a></pre>
<div class="block"><p>
 Does asynchronous shipping of log records from the master to the slave being
 replicated to. The implementation does not ship log records as soon as they
 become available in the log buffer (synchronously), instead it does log
 shipping in the following two-fold scenarios

 1) Periodically (i.e.) at regular intervals of time.

 2) when a request is sent from the master controller (force flushing of
    the log buffer).

 3) when a notification is received from the log shipper about a log
    buffer element becoming full and the load on the log buffer so
    warrants a ship.
 </p></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested.class.summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<ul class="blockList">
<li class="blockList"><a name="nested.classes.inherited.from.class.java.lang.Thread">
<!--   -->
</a>
<h3>Nested classes/interfaces inherited from class&nbsp;java.lang.Thread</h3>
<code>java.lang.Thread.State, java.lang.Thread.UncaughtExceptionHandler</code></li>
</ul>
</li>
</ul>
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#DEFAULT_FORCEFLUSH_TIMEOUT">DEFAULT_FORCEFLUSH_TIMEOUT</a></span></code>
<div class="block">The number of millis a call to forceFlush will wait before giving
 up sending a chunk of log to the slave</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/impl/store/replication/net/ReplicationMessage.html" title="class in org.apache.derby.impl.store.replication.net">ReplicationMessage</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#failedChunk">failedChunk</a></span></code>
<div class="block">Store the log chunk that failed during a previous shipping attempt
 so that it can be re-shipped to the slave.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#failedChunkHighestInstant">failedChunkHighestInstant</a></span></code>
<div class="block">The highest log instant in failedChunk</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#FI_HIGH">FI_HIGH</a></span></code>
<div class="block">Fill information value indicative of a high load in the log buffer.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#FI_LOW">FI_LOW</a></span></code>
<div class="block">Fill information value indicative of a low load in the log buffer.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private java.lang.Object</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#forceFlushSemaphore">forceFlushSemaphore</a></span></code>
<div class="block">Used to synchronize forceFlush calls</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#highestShippedInstant">highestShippedInstant</a></span></code>
<div class="block">The highest log instant shipped so far</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#lastShippingTime">lastShippingTime</a></span></code>
<div class="block">Will store the time at which the last shipping happened.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/impl/store/replication/buffer/ReplicationLogBuffer.html" title="class in org.apache.derby.impl.store.replication.buffer">ReplicationLogBuffer</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#logBuffer">logBuffer</a></span></code>
<div class="block">Replication log buffer that contains the log records that need to
 be transmitted to the slave.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/impl/store/replication/master/MasterController.html" title="class in org.apache.derby.impl.store.replication.master">MasterController</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#masterController">masterController</a></span></code>
<div class="block">The master controller that initialized this log shipper.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#MAX">MAX</a></span></code>
<div class="block">If the fill information is less than FI_LOW the log shipper will ship 
 with a MAX ms delay or when a buffer becomes full whichever comes 
 first.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#maxShippingInterval">maxShippingInterval</a></span></code>
<div class="block">Minimum interval (in milliseconds) between log shipping.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#MIN">MIN</a></span></code>
<div class="block">If the fill information (obtained from the log buffer) is less than 
 FI_HIGH but greater than FI_LOW the log shipper will ship with a MIN ms delay.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#minShippingInterval">minShippingInterval</a></span></code>
<div class="block">Minimum interval (in milliseconds) between log shipping.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private java.lang.Object</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#objLSTSync">objLSTSync</a></span></code>
<div class="block">Object used to synchronize on while the log shipper thread
 is moved into the wait state, or while notifying it.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/impl/store/replication/ReplicationLogger.html" title="class in org.apache.derby.impl.store.replication">ReplicationLogger</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#repLogger">repLogger</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#shippingInterval">shippingInterval</a></span></code>
<div class="block">Time interval (in milliseconds) at which the log shipping takes place.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#stopShipping">stopShipping</a></span></code>
<div class="block">Indicates whether a stop shipping request has been sent.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/impl/store/replication/net/ReplicationMessageTransmit.html" title="class in org.apache.derby.impl.store.replication.net">ReplicationMessageTransmit</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#transmitter">transmitter</a></span></code>
<div class="block">Replication message transmitter that is used for the network
 transmission of the log records retrieved from the log buffer
 (on the master) to the slave being replicated to.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="fields.inherited.from.class.java.lang.Thread">
<!--   -->
</a>
<h3>Fields inherited from class&nbsp;java.lang.Thread</h3>
<code>MAX_PRIORITY, MIN_PRIORITY, NORM_PRIORITY</code></li>
</ul>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#AsynchronousLogShipper-org.apache.derby.impl.store.replication.buffer.ReplicationLogBuffer-org.apache.derby.impl.store.replication.net.ReplicationMessageTransmit-org.apache.derby.impl.store.replication.master.MasterController-org.apache.derby.impl.store.replication.ReplicationLogger-">AsynchronousLogShipper</a></span>(<a href="../../../../../../../org/apache/derby/impl/store/replication/buffer/ReplicationLogBuffer.html" title="class in org.apache.derby.impl.store.replication.buffer">ReplicationLogBuffer</a>&nbsp;logBuffer,
                      <a href="../../../../../../../org/apache/derby/impl/store/replication/net/ReplicationMessageTransmit.html" title="class in org.apache.derby.impl.store.replication.net">ReplicationMessageTransmit</a>&nbsp;transmitter,
                      <a href="../../../../../../../org/apache/derby/impl/store/replication/master/MasterController.html" title="class in org.apache.derby.impl.store.replication.master">MasterController</a>&nbsp;masterController,
                      <a href="../../../../../../../org/apache/derby/impl/store/replication/ReplicationLogger.html" title="class in org.apache.derby.impl.store.replication">ReplicationLogger</a>&nbsp;repLogger)</code>
<div class="block">Constructor initializes the log buffer, the replication message
 transmitter, the shipping interval and the master controller.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>private long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#calculateSIfromFI--">calculateSIfromFI</a></span>()</code>
<div class="block">Will be used to calculate the shipping interval based on the fill
 information obtained from the log buffer.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#flushBuffer--">flushBuffer</a></span>()</code>
<div class="block">Transmits all the log records in the log buffer to the slave.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#flushedInstance-long-">flushedInstance</a></span>(long&nbsp;latestInstanceFlushedToDisk)</code>
<div class="block">updates the information about the latest instance of the log record
 that has been flushed to the disk.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#forceFlush--">forceFlush</a></span>()</code>
<div class="block">Transmits a chunk of log record from the log buffer to the slave, used
 by the master controller when the log buffer is full and some space
 needs to be freed for further log records.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#getHighestShippedInstant--">getHighestShippedInstant</a></span>()</code>
<div class="block">Get the highest log instant shipped so far</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#getLogShipperProperties--">getLogShipperProperties</a></span>()</code>
<div class="block">Load relevant system properties: max and min log shipping interval</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#run--">run</a></span>()</code>
<div class="block">Ships log records from the log buffer to the slave being replicated to.</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>private boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#shipALogChunk--">shipALogChunk</a></span>()</code>
<div class="block">Retrieves a chunk of log records, if available, from the log buffer and
 transmits them to the slave.</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#stopLogShipment--">stopLogShipment</a></span>()</code>
<div class="block">Stop shipping log records.</div>
</td>
</tr>
<tr id="i9" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#workToDo--">workToDo</a></span>()</code>
<div class="block">Used to notify the log shipper that a log buffer element is full.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Thread">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Thread</h3>
<code>activeCount, checkAccess, clone, countStackFrames, currentThread, destroy, dumpStack, enumerate, getAllStackTraces, getContextClassLoader, getDefaultUncaughtExceptionHandler, getId, getName, getPriority, getStackTrace, getState, getThreadGroup, getUncaughtExceptionHandler, holdsLock, interrupt, interrupted, isAlive, isDaemon, isInterrupted, join, join, join, resume, setContextClassLoader, setDaemon, setDefaultUncaughtExceptionHandler, setName, setPriority, setUncaughtExceptionHandler, sleep, sleep, start, stop, stop, suspend, toString, yield</code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>equals, finalize, getClass, hashCode, notify, notifyAll, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="logBuffer">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>logBuffer</h4>
<pre>private final&nbsp;<a href="../../../../../../../org/apache/derby/impl/store/replication/buffer/ReplicationLogBuffer.html" title="class in org.apache.derby.impl.store.replication.buffer">ReplicationLogBuffer</a> logBuffer</pre>
<div class="block">Replication log buffer that contains the log records that need to
 be transmitted to the slave.</div>
</li>
</ul>
<a name="transmitter">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>transmitter</h4>
<pre>private&nbsp;<a href="../../../../../../../org/apache/derby/impl/store/replication/net/ReplicationMessageTransmit.html" title="class in org.apache.derby.impl.store.replication.net">ReplicationMessageTransmit</a> transmitter</pre>
<div class="block">Replication message transmitter that is used for the network
 transmission of the log records retrieved from the log buffer
 (on the master) to the slave being replicated to.</div>
</li>
</ul>
<a name="shippingInterval">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>shippingInterval</h4>
<pre>private&nbsp;long shippingInterval</pre>
<div class="block">Time interval (in milliseconds) at which the log shipping takes place.</div>
</li>
</ul>
<a name="minShippingInterval">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>minShippingInterval</h4>
<pre>private&nbsp;long minShippingInterval</pre>
<div class="block">Minimum interval (in milliseconds) between log shipping.
 Defaults to MIN, but can be configured using system property
 derby.replication.minLogShippingInterval</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#MIN"><code>MIN</code></a></dd>
</dl>
</li>
</ul>
<a name="maxShippingInterval">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>maxShippingInterval</h4>
<pre>private&nbsp;long maxShippingInterval</pre>
<div class="block">Minimum interval (in milliseconds) between log shipping.
 Defaults to MAX, but can be configured using system property
 derby.replication.maxLogShippingInterval</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html#MAX"><code>MAX</code></a></dd>
</dl>
</li>
</ul>
<a name="lastShippingTime">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>lastShippingTime</h4>
<pre>private&nbsp;long lastShippingTime</pre>
<div class="block">Will store the time at which the last shipping happened. Will be used
 to calculate the interval between the log ships upon receiving a
 notification from the log buffer.</div>
</li>
</ul>
<a name="stopShipping">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>stopShipping</h4>
<pre>private volatile&nbsp;boolean stopShipping</pre>
<div class="block">Indicates whether a stop shipping request has been sent.
 true - stop shipping log records
 false - shipping can continue without interruption.</div>
</li>
</ul>
<a name="masterController">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>masterController</h4>
<pre>private&nbsp;<a href="../../../../../../../org/apache/derby/impl/store/replication/master/MasterController.html" title="class in org.apache.derby.impl.store.replication.master">MasterController</a> masterController</pre>
<div class="block">The master controller that initialized this log shipper.</div>
</li>
</ul>
<a name="objLSTSync">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>objLSTSync</h4>
<pre>private&nbsp;java.lang.Object objLSTSync</pre>
<div class="block">Object used to synchronize on while the log shipper thread
 is moved into the wait state, or while notifying it.</div>
</li>
</ul>
<a name="forceFlushSemaphore">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>forceFlushSemaphore</h4>
<pre>private&nbsp;java.lang.Object forceFlushSemaphore</pre>
<div class="block">Used to synchronize forceFlush calls</div>
</li>
</ul>
<a name="DEFAULT_FORCEFLUSH_TIMEOUT">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>DEFAULT_FORCEFLUSH_TIMEOUT</h4>
<pre>public static final&nbsp;int DEFAULT_FORCEFLUSH_TIMEOUT</pre>
<div class="block">The number of millis a call to forceFlush will wait before giving
 up sending a chunk of log to the slave</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../constant-values.html#org.apache.derby.impl.store.replication.master.AsynchronousLogShipper.DEFAULT_FORCEFLUSH_TIMEOUT">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="failedChunk">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>failedChunk</h4>
<pre>private&nbsp;<a href="../../../../../../../org/apache/derby/impl/store/replication/net/ReplicationMessage.html" title="class in org.apache.derby.impl.store.replication.net">ReplicationMessage</a> failedChunk</pre>
<div class="block">Store the log chunk that failed during a previous shipping attempt
 so that it can be re-shipped to the slave.</div>
</li>
</ul>
<a name="failedChunkHighestInstant">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>failedChunkHighestInstant</h4>
<pre>private&nbsp;long failedChunkHighestInstant</pre>
<div class="block">The highest log instant in failedChunk</div>
</li>
</ul>
<a name="highestShippedInstant">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>highestShippedInstant</h4>
<pre>private&nbsp;long highestShippedInstant</pre>
<div class="block">The highest log instant shipped so far</div>
</li>
</ul>
<a name="FI_LOW">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>FI_LOW</h4>
<pre>private static final&nbsp;int FI_LOW</pre>
<div class="block">Fill information value indicative of a low load in the log buffer.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../constant-values.html#org.apache.derby.impl.store.replication.master.AsynchronousLogShipper.FI_LOW">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="FI_HIGH">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>FI_HIGH</h4>
<pre>private static final&nbsp;int FI_HIGH</pre>
<div class="block">Fill information value indicative of a high load in the log buffer.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../constant-values.html#org.apache.derby.impl.store.replication.master.AsynchronousLogShipper.FI_HIGH">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="MIN">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>MIN</h4>
<pre>private static final&nbsp;long MIN</pre>
<div class="block">If the fill information (obtained from the log buffer) is less than 
 FI_HIGH but greater than FI_LOW the log shipper will ship with a MIN ms delay.
 MIN is a value that is only as large as not to affect the performance
 of the master database significantly.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../constant-values.html#org.apache.derby.impl.store.replication.master.AsynchronousLogShipper.MIN">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="MAX">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>MAX</h4>
<pre>private static final&nbsp;long MAX</pre>
<div class="block">If the fill information is less than FI_LOW the log shipper will ship 
 with a MAX ms delay or when a buffer becomes full whichever comes 
 first. The delay however will not be smaller than MIN. 
 max(MAX, DEFAULT_NUMBER_LOG_BUFFERS*MIN) is the maximum delay between a 
 log record is committed at the master until it is replicated  to the 
 slave. Hence the default latency should be atleast greater than the maximum
 latency offered by the choice of MIN, hence MAX &gt; DEFAULT_NUMBER_LOG_BUFFERS*MIN.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../constant-values.html#org.apache.derby.impl.store.replication.master.AsynchronousLogShipper.MAX">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="repLogger">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>repLogger</h4>
<pre>private final&nbsp;<a href="../../../../../../../org/apache/derby/impl/store/replication/ReplicationLogger.html" title="class in org.apache.derby.impl.store.replication">ReplicationLogger</a> repLogger</pre>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="AsynchronousLogShipper-org.apache.derby.impl.store.replication.buffer.ReplicationLogBuffer-org.apache.derby.impl.store.replication.net.ReplicationMessageTransmit-org.apache.derby.impl.store.replication.master.MasterController-org.apache.derby.impl.store.replication.ReplicationLogger-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>AsynchronousLogShipper</h4>
<pre>public&nbsp;AsynchronousLogShipper(<a href="../../../../../../../org/apache/derby/impl/store/replication/buffer/ReplicationLogBuffer.html" title="class in org.apache.derby.impl.store.replication.buffer">ReplicationLogBuffer</a>&nbsp;logBuffer,
                              <a href="../../../../../../../org/apache/derby/impl/store/replication/net/ReplicationMessageTransmit.html" title="class in org.apache.derby.impl.store.replication.net">ReplicationMessageTransmit</a>&nbsp;transmitter,
                              <a href="../../../../../../../org/apache/derby/impl/store/replication/master/MasterController.html" title="class in org.apache.derby.impl.store.replication.master">MasterController</a>&nbsp;masterController,
                              <a href="../../../../../../../org/apache/derby/impl/store/replication/ReplicationLogger.html" title="class in org.apache.derby.impl.store.replication">ReplicationLogger</a>&nbsp;repLogger)</pre>
<div class="block">Constructor initializes the log buffer, the replication message
 transmitter, the shipping interval and the master controller.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>logBuffer</code> - the replication log buffer that contains the log record
                  chunks to be transmitted to the slave.</dd>
<dd><code>transmitter</code> - the replication message transmitter that is used for
                    network transmission of retrieved log records.</dd>
<dd><code>masterController</code> - The master controller that initialized this log
                         shipper.</dd>
<dd><code>repLogger</code> - The replication logger that will write messages to
 the log file (typically derby.log)</dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="run--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>run</h4>
<pre>public&nbsp;void&nbsp;run()</pre>
<div class="block">Ships log records from the log buffer to the slave being replicated to.
 The log shipping happens between shipping intervals of time, the 
 shipping interval being derived from the fill information (an indicator
 of load in the log buffer) obtained from the log buffer. The shipping
 can also be triggered in the following situations,
 
 1) Based on notifications from the log buffer, where the fill 
    information is again used as the basis to decide whether a
    shipping should happen or not
 2) On a forceFlush triggered by the log buffer becoming full
    and the LogBufferFullException being thrown.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code>run</code>&nbsp;in interface&nbsp;<code>java.lang.Runnable</code></dd>
<dt><span class="overrideSpecifyLabel">Overrides:</span></dt>
<dd><code>run</code>&nbsp;in class&nbsp;<code>java.lang.Thread</code></dd>
</dl>
</li>
</ul>
<a name="shipALogChunk--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>shipALogChunk</h4>
<pre>private&nbsp;boolean&nbsp;shipALogChunk()
                       throws java.io.IOException,
                              <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Retrieves a chunk of log records, if available, from the log buffer and
 transmits them to the slave. Used for both periodic and forced shipping.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>true if a chunk of log records was shipped.
         false if no log records were shipped because log buffer is empty.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code> - If an exception occurs while trying to ship the
                     replication message (containing the log records)
                     across the network.</dd>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - If an exception occurs while trying to read
                           log records from the log buffer.</dd>
</dl>
</li>
</ul>
<a name="flushBuffer--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>flushBuffer</h4>
<pre>public&nbsp;void&nbsp;flushBuffer()
                 throws java.io.IOException,
                        <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Transmits all the log records in the log buffer to the slave.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/impl/store/replication/master/LogShipper.html#flushBuffer--">flushBuffer</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../../org/apache/derby/impl/store/replication/master/LogShipper.html" title="interface in org.apache.derby.impl.store.replication.master">LogShipper</a></code></dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code> - If an exception occurs while trying to ship the
                     replication message (containing the log records)
                     across the network.</dd>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - If an exception occurs while trying to read
                           log records from the log buffer.</dd>
</dl>
</li>
</ul>
<a name="forceFlush--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>forceFlush</h4>
<pre>public&nbsp;void&nbsp;forceFlush()
                throws java.io.IOException,
                       <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Transmits a chunk of log record from the log buffer to the slave, used
 by the master controller when the log buffer is full and some space
 needs to be freed for further log records.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/impl/store/replication/master/LogShipper.html#forceFlush--">forceFlush</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../../org/apache/derby/impl/store/replication/master/LogShipper.html" title="interface in org.apache.derby.impl.store.replication.master">LogShipper</a></code></dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code> - If an exception occurs while trying to ship the
                     replication message (containing the log records)
                     across the network.</dd>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - If an exception occurs while trying to read
                           log records from the log buffer.</dd>
</dl>
</li>
</ul>
<a name="getHighestShippedInstant--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getHighestShippedInstant</h4>
<pre>public&nbsp;long&nbsp;getHighestShippedInstant()</pre>
<div class="block">Get the highest log instant shipped so far</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the highest log instant shipped so far</dd>
</dl>
</li>
</ul>
<a name="flushedInstance-long-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>flushedInstance</h4>
<pre>public&nbsp;void&nbsp;flushedInstance(long&nbsp;latestInstanceFlushedToDisk)</pre>
<div class="block">updates the information about the latest instance of the log record
 that has been flushed to the disk. Calling this method has no effect
 in this asynchronous implementation of the log shipper.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/impl/store/replication/master/LogShipper.html#flushedInstance-long-">flushedInstance</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../../org/apache/derby/impl/store/replication/master/LogShipper.html" title="interface in org.apache.derby.impl.store.replication.master">LogShipper</a></code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>latestInstanceFlushedToDisk</code> - a long that contains the latest
        instance of the log record that has been flushed to the disk.</dd>
</dl>
</li>
</ul>
<a name="stopLogShipment--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>stopLogShipment</h4>
<pre>public&nbsp;void&nbsp;stopLogShipment()</pre>
<div class="block">Stop shipping log records. If a ship is currently in progress
 it will not be interrupted, shipping will stop only after the
 current shipment is done.</div>
</li>
</ul>
<a name="workToDo--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>workToDo</h4>
<pre>public&nbsp;void&nbsp;workToDo()</pre>
<div class="block">Used to notify the log shipper that a log buffer element is full.
 This method would basically use the following steps to decide on the 
 action to be taken when a notification from the log shipper is received,
 
 a) Get FI from log buffer
 b) If FI &gt;= FI_HIGH
     b.1) notify the log shipper thread.
 c) Else If the time elapsed since last ship is greater than
    minShippingInterval
     c.1) notify the log shipper thread.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/impl/store/replication/master/LogShipper.html#workToDo--">workToDo</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../../org/apache/derby/impl/store/replication/master/LogShipper.html" title="interface in org.apache.derby.impl.store.replication.master">LogShipper</a></code></dd>
</dl>
</li>
</ul>
<a name="calculateSIfromFI--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>calculateSIfromFI</h4>
<pre>private&nbsp;long&nbsp;calculateSIfromFI()</pre>
<div class="block">Will be used to calculate the shipping interval based on the fill
 information obtained from the log buffer. This method uses the following
 steps to arrive at the shipping interval,
 
 a) FI &gt;= FI_HIGH return -1 (signifies that the waiting time should be 0)
 b) FI &gt;  FI_LOW and FI &lt; FI_HIGH return minShippingInterval
 c) FI &lt;= FI_LOW return maxShippingInterval.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the shipping interval based on the fill information.</dd>
</dl>
</li>
</ul>
<a name="getLogShipperProperties--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getLogShipperProperties</h4>
<pre>private&nbsp;void&nbsp;getLogShipperProperties()</pre>
<div class="block">Load relevant system properties: max and min log shipping interval</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage">Built on Mon 2017-07-03 23:03:59+0530, from revision Unversioned directory</div>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../../../../org/apache/derby/impl/store/replication/master/LogShipper.html" title="interface in org.apache.derby.impl.store.replication.master"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../index.html?org/apache/derby/impl/store/replication/master/AsynchronousLogShipper.html" target="_top">Frames</a></li>
<li><a href="AsynchronousLogShipper.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.classes.inherited.from.class.java.lang.Thread">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Apache Derby V10.13 Internals - <i>Copyright &copy; 2004,2016 The Apache Software Foundation. All Rights Reserved.</i></small></p>
</body>
</html>
