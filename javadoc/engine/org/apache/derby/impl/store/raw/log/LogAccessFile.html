<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_66) on Mon Jul 03 23:05:21 IST 2017 -->
<title>LogAccessFile (Apache Derby V10.13 Internals)</title>
<meta name="date" content="2017-07-03">
<link rel="stylesheet" type="text/css" href="../../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="LogAccessFile (Apache Derby V10.13 Internals)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10,"i7":10,"i8":10,"i9":10,"i10":10,"i11":10,"i12":10,"i13":10,"i14":10,"i15":10,"i16":10,"i17":10,"i18":10,"i19":10,"i20":10,"i21":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FlushedScanHandle.html" title="class in org.apache.derby.impl.store.raw.log"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFileBuffer.html" title="class in org.apache.derby.impl.store.raw.log"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../index.html?org/apache/derby/impl/store/raw/log/LogAccessFile.html" target="_top">Frames</a></li>
<li><a href="LogAccessFile.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.derby.impl.store.raw.log</div>
<h2 title="Class LogAccessFile" class="title">Class LogAccessFile</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.apache.derby.impl.store.raw.log.LogAccessFile</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">LogAccessFile</span>
extends java.lang.Object</pre>
<div class="block">Wraps a RandomAccessFile file to provide buffering
        on log writes. Only supports the write calls
        required for the log!

        MT - unsafe.  Caller of this class must provide synchronization.  The one
        exception is with the log file access, LogAccessFile will touch the log
        only inside synchronized block protected by the semaphore, which is
        defined by the creator of this object.
        
    Write to the log buffers are allowed when there are free buffers even
    when dirty buffers are being written(flushed) to the disk by a different
        thread. Only one flush writes to log file at a time, other wait for it to finish.

        Except for flushLogAccessFile , SyncAccessLogFile other function callers
        must provide syncronization that will allow only one of them to write to 
    the buffers. 

    Log Buffers are used in circular fashion, each buffer moves through following stages: 
        freeBuffers --&gt; dirtyBuffers --&gt; freeBuffers. Movement of buffers from one
    stage to    another stage is synchronized using     the object(this) of this class. 

        A Checksum log record that has the checksum value for the data that is
    being written to the disk is generated and written  before the actual data. 
        Except for the large log records that does not fit into a single buffer, 
    checksum is calcualted for a group of log records that are in the buffer 
        when buffers is switched. Checksum log record is written into the reserved
        space in the beginning buffer. 

    In case of a large log record that does not fit into a buffer, the
    checksum is written to the byte[] allocated for the big log
    record. 

        Checksum log records helps in identifying the incomplete log disk writes during 
    recovery. This is done by recalculating the checksum value for the data on
    the disk and comparing it to the the value stored in the checksum log
    record.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#checksumInstant">checksumInstant</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#checksumLength">checksumLength</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/impl/store/raw/log/ChecksumOperation.html" title="class in org.apache.derby.impl.store.raw.log">ChecksumOperation</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#checksumLogOperation">checksumLogOperation</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogRecord.html" title="class in org.apache.derby.impl.store.raw.log">LogRecord</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#checksumLogRecord">checksumLogRecord</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#checksumLogRecordSize">checksumLogRecordSize</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFileBuffer.html" title="class in org.apache.derby.impl.store.raw.log">LogAccessFileBuffer</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#currentBuffer">currentBuffer</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#databaseEncrypted">databaseEncrypted</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private java.util.LinkedList&lt;<a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFileBuffer.html" title="class in org.apache.derby.impl.store.raw.log">LogAccessFileBuffer</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#dirtyBuffers">dirtyBuffers</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#flushInProgress">flushInProgress</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private java.util.LinkedList&lt;<a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFileBuffer.html" title="class in org.apache.derby.impl.store.raw.log">LogAccessFileBuffer</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#freeBuffers">freeBuffers</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(package private) boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#inReplicationMasterMode">inReplicationMasterMode</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>(package private) boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#inReplicationSlaveMode">inReplicationSlaveMode</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/io/StorageRandomAccessFile.html" title="interface in org.apache.derby.io">StorageRandomAccessFile</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#log">log</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#LOG_NUMBER_LOG_BUFFERS">LOG_NUMBER_LOG_BUFFERS</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#LOG_RECORD_FIXED_OVERHEAD_SIZE">LOG_RECORD_FIXED_OVERHEAD_SIZE</a></span></code>
<div class="block">The fixed size of a log record is 16 bytes:
     int   length             : 4 bytes
     long  instant            : 8 bytes
     int   trailing length    : 4 bytes</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#LOG_RECORD_HEADER_SIZE">LOG_RECORD_HEADER_SIZE</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#LOG_RECORD_TRAILER_SIZE">LOG_RECORD_TRAILER_SIZE</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogToFile.html" title="class in org.apache.derby.impl.store.raw.log">LogToFile</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#logFactory">logFactory</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private java.lang.Object</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#logFileSemaphore">logFileSemaphore</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/iapi/services/io/FormatIdOutputStream.html" title="class in org.apache.derby.iapi.services.io">FormatIdOutputStream</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#logicalOut">logicalOut</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/iapi/services/io/ArrayOutputStream.html" title="class in org.apache.derby.iapi.services.io">ArrayOutputStream</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#logOutputBuffer">logOutputBuffer</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>(package private) <a href="../../../../../../../org/apache/derby/iapi/store/replication/master/MasterFactory.html" title="interface in org.apache.derby.iapi.store.replication.master">MasterFactory</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#masterFac">masterFac</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(package private) static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#mon_numBytesToLog">mon_numBytesToLog</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>(package private) static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#mon_numWritesToLog">mon_numWritesToLog</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#writeChecksum">writeChecksum</a></span></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#LogAccessFile-org.apache.derby.impl.store.raw.log.LogToFile-org.apache.derby.io.StorageRandomAccessFile-int-">LogAccessFile</a></span>(<a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogToFile.html" title="class in org.apache.derby.impl.store.raw.log">LogToFile</a>&nbsp;logFactory,
             <a href="../../../../../../../org/apache/derby/io/StorageRandomAccessFile.html" title="interface in org.apache.derby.io">StorageRandomAccessFile</a>&nbsp;log,
             int&nbsp;bufferSize)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>private int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#appendLogRecordToBuffer-byte:A-int-int-long-byte:A-int-byte:A-int-int-">appendLogRecordToBuffer</a></span>(byte[]&nbsp;buff,
                       int&nbsp;pos,
                       int&nbsp;length,
                       long&nbsp;instant,
                       byte[]&nbsp;data,
                       int&nbsp;data_offset,
                       byte[]&nbsp;optional_data,
                       int&nbsp;optional_data_offset,
                       int&nbsp;optional_data_length)</code>
<div class="block">Append a log record to a byte[].</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#close--">close</a></span>()</code>&nbsp;</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#corrupt--">corrupt</a></span>()</code>
<div class="block">The database is being marked corrupted, get rid of file pointer without
                writing out anything more.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#flushDirtyBuffers--">flushDirtyBuffers</a></span>()</code>
<div class="block">Write data from all dirty buffers into the log file.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#flushLogAccessFile--">flushLogAccessFile</a></span>()</code>&nbsp;</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#getChecksumLogRecordSize--">getChecksumLogRecordSize</a></span>()</code>
<div class="block">Return the length of a checksum record</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>protected long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#reserveSpaceForChecksum-int-long-long-">reserveSpaceForChecksum</a></span>(int&nbsp;length,
                       long&nbsp;logFileNumber,
                       long&nbsp;currentPosition)</code>
<div class="block">reserve the space for the checksum log record in the log file.</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#setReplicationMasterRole-org.apache.derby.iapi.store.replication.master.MasterFactory-">setReplicationMasterRole</a></span>(<a href="../../../../../../../org/apache/derby/iapi/store/replication/master/MasterFactory.html" title="interface in org.apache.derby.iapi.store.replication.master">MasterFactory</a>&nbsp;masterFac)</code>
<div class="block">Make this LogAccessFile pass chunks of log records (byte[]) to
 the MasterFactory when the chunks are written to disk.</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#setReplicationSlaveRole--">setReplicationSlaveRole</a></span>()</code>
<div class="block">Method to put this LogAccessFile object in replication slave
 mode, effectively disabling checksum writes.</div>
</td>
</tr>
<tr id="i9" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#stopReplicationMasterRole--">stopReplicationMasterRole</a></span>()</code>
<div class="block">Stop this LogAccessFile from passing chunks of log records to
 the MasterFactory.</div>
</td>
</tr>
<tr id="i10" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#switchLogBuffer--">switchLogBuffer</a></span>()</code>
<div class="block">Appends the current Buffer to the dirty Buffer list and assigns a free
 buffer to be the currrent active buffer .</div>
</td>
</tr>
<tr id="i11" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#syncLogAccessFile--">syncLogAccessFile</a></span>()</code>
<div class="block">Guarantee all writes up to the last call to flushLogAccessFile on disk.</div>
</td>
</tr>
<tr id="i12" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#write-byte:A-int-int-">write</a></span>(byte[]&nbsp;b,
     int&nbsp;off,
     int&nbsp;len)</code>&nbsp;</td>
</tr>
<tr id="i13" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#write-int-">write</a></span>(int&nbsp;b)</code>&nbsp;</td>
</tr>
<tr id="i14" class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#writeChecksumLogRecord-byte:A-">writeChecksumLogRecord</a></span>(byte[]&nbsp;buffer)</code>
<div class="block">Generate the checkum log record and write it into the log
 buffer.</div>
</td>
</tr>
<tr id="i15" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#writeEndMarker-int-">writeEndMarker</a></span>(int&nbsp;marker)</code>&nbsp;</td>
</tr>
<tr id="i16" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#writeInt-int-">writeInt</a></span>(int&nbsp;i)</code>&nbsp;</td>
</tr>
<tr id="i17" class="rowColor">
<td class="colFirst"><code>private int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#writeInt-int-byte:A-int-">writeInt</a></span>(int&nbsp;i,
        byte[]&nbsp;b,
        int&nbsp;p)</code>&nbsp;</td>
</tr>
<tr id="i18" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#writeLogRecord-int-long-byte:A-int-byte:A-int-int-">writeLogRecord</a></span>(int&nbsp;length,
              long&nbsp;instant,
              byte[]&nbsp;data,
              int&nbsp;data_offset,
              byte[]&nbsp;optional_data,
              int&nbsp;optional_data_offset,
              int&nbsp;optional_data_length)</code>
<div class="block">Write a single log record to the stream.</div>
</td>
</tr>
<tr id="i19" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#writeLong-long-">writeLong</a></span>(long&nbsp;l)</code>&nbsp;</td>
</tr>
<tr id="i20" class="altColor">
<td class="colFirst"><code>private int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#writeLong-long-byte:A-int-">writeLong</a></span>(long&nbsp;l,
         byte[]&nbsp;b,
         int&nbsp;p)</code>&nbsp;</td>
</tr>
<tr id="i21" class="rowColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#writeToLog-byte:A-int-int-long-">writeToLog</a></span>(byte[]&nbsp;b,
          int&nbsp;off,
          int&nbsp;len,
          long&nbsp;highestInstant)</code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="LOG_RECORD_FIXED_OVERHEAD_SIZE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>LOG_RECORD_FIXED_OVERHEAD_SIZE</h4>
<pre>private static final&nbsp;int LOG_RECORD_FIXED_OVERHEAD_SIZE</pre>
<div class="block">The fixed size of a log record is 16 bytes:
     int   length             : 4 bytes
     long  instant            : 8 bytes
     int   trailing length    : 4 bytes</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../constant-values.html#org.apache.derby.impl.store.raw.log.LogAccessFile.LOG_RECORD_FIXED_OVERHEAD_SIZE">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="LOG_RECORD_HEADER_SIZE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>LOG_RECORD_HEADER_SIZE</h4>
<pre>private static final&nbsp;int LOG_RECORD_HEADER_SIZE</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../constant-values.html#org.apache.derby.impl.store.raw.log.LogAccessFile.LOG_RECORD_HEADER_SIZE">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="LOG_RECORD_TRAILER_SIZE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>LOG_RECORD_TRAILER_SIZE</h4>
<pre>private static final&nbsp;int LOG_RECORD_TRAILER_SIZE</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../constant-values.html#org.apache.derby.impl.store.raw.log.LogAccessFile.LOG_RECORD_TRAILER_SIZE">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="LOG_NUMBER_LOG_BUFFERS">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>LOG_NUMBER_LOG_BUFFERS</h4>
<pre>private static final&nbsp;int LOG_NUMBER_LOG_BUFFERS</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../constant-values.html#org.apache.derby.impl.store.raw.log.LogAccessFile.LOG_NUMBER_LOG_BUFFERS">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="freeBuffers">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>freeBuffers</h4>
<pre>private&nbsp;java.util.LinkedList&lt;<a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFileBuffer.html" title="class in org.apache.derby.impl.store.raw.log">LogAccessFileBuffer</a>&gt; freeBuffers</pre>
</li>
</ul>
<a name="dirtyBuffers">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>dirtyBuffers</h4>
<pre>private&nbsp;java.util.LinkedList&lt;<a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFileBuffer.html" title="class in org.apache.derby.impl.store.raw.log">LogAccessFileBuffer</a>&gt; dirtyBuffers</pre>
</li>
</ul>
<a name="currentBuffer">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>currentBuffer</h4>
<pre>private&nbsp;<a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFileBuffer.html" title="class in org.apache.derby.impl.store.raw.log">LogAccessFileBuffer</a> currentBuffer</pre>
</li>
</ul>
<a name="flushInProgress">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>flushInProgress</h4>
<pre>private&nbsp;boolean flushInProgress</pre>
</li>
</ul>
<a name="log">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>log</h4>
<pre>private final&nbsp;<a href="../../../../../../../org/apache/derby/io/StorageRandomAccessFile.html" title="interface in org.apache.derby.io">StorageRandomAccessFile</a> log</pre>
</li>
</ul>
<a name="logFileSemaphore">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>logFileSemaphore</h4>
<pre>private final&nbsp;java.lang.Object logFileSemaphore</pre>
</li>
</ul>
<a name="mon_numWritesToLog">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>mon_numWritesToLog</h4>
<pre>static&nbsp;int mon_numWritesToLog</pre>
</li>
</ul>
<a name="mon_numBytesToLog">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>mon_numBytesToLog</h4>
<pre>static&nbsp;int mon_numBytesToLog</pre>
</li>
</ul>
<a name="masterFac">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>masterFac</h4>
<pre><a href="../../../../../../../org/apache/derby/iapi/store/replication/master/MasterFactory.html" title="interface in org.apache.derby.iapi.store.replication.master">MasterFactory</a> masterFac</pre>
</li>
</ul>
<a name="inReplicationMasterMode">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>inReplicationMasterMode</h4>
<pre>boolean inReplicationMasterMode</pre>
</li>
</ul>
<a name="inReplicationSlaveMode">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>inReplicationSlaveMode</h4>
<pre>boolean inReplicationSlaveMode</pre>
</li>
</ul>
<a name="logOutputBuffer">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>logOutputBuffer</h4>
<pre>private&nbsp;<a href="../../../../../../../org/apache/derby/iapi/services/io/ArrayOutputStream.html" title="class in org.apache.derby.iapi.services.io">ArrayOutputStream</a> logOutputBuffer</pre>
</li>
</ul>
<a name="logicalOut">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>logicalOut</h4>
<pre>private&nbsp;<a href="../../../../../../../org/apache/derby/iapi/services/io/FormatIdOutputStream.html" title="class in org.apache.derby.iapi.services.io">FormatIdOutputStream</a> logicalOut</pre>
</li>
</ul>
<a name="checksumInstant">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checksumInstant</h4>
<pre>private&nbsp;long checksumInstant</pre>
</li>
</ul>
<a name="checksumLength">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checksumLength</h4>
<pre>private&nbsp;int checksumLength</pre>
</li>
</ul>
<a name="checksumLogRecordSize">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checksumLogRecordSize</h4>
<pre>private&nbsp;int checksumLogRecordSize</pre>
</li>
</ul>
<a name="writeChecksum">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>writeChecksum</h4>
<pre>private&nbsp;boolean writeChecksum</pre>
</li>
</ul>
<a name="checksumLogOperation">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checksumLogOperation</h4>
<pre>private&nbsp;<a href="../../../../../../../org/apache/derby/impl/store/raw/log/ChecksumOperation.html" title="class in org.apache.derby.impl.store.raw.log">ChecksumOperation</a> checksumLogOperation</pre>
</li>
</ul>
<a name="checksumLogRecord">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checksumLogRecord</h4>
<pre>private&nbsp;<a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogRecord.html" title="class in org.apache.derby.impl.store.raw.log">LogRecord</a> checksumLogRecord</pre>
</li>
</ul>
<a name="logFactory">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>logFactory</h4>
<pre>private&nbsp;<a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogToFile.html" title="class in org.apache.derby.impl.store.raw.log">LogToFile</a> logFactory</pre>
</li>
</ul>
<a name="databaseEncrypted">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>databaseEncrypted</h4>
<pre>private&nbsp;boolean databaseEncrypted</pre>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="LogAccessFile-org.apache.derby.impl.store.raw.log.LogToFile-org.apache.derby.io.StorageRandomAccessFile-int-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>LogAccessFile</h4>
<pre>public&nbsp;LogAccessFile(<a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogToFile.html" title="class in org.apache.derby.impl.store.raw.log">LogToFile</a>&nbsp;logFactory,
                     <a href="../../../../../../../org/apache/derby/io/StorageRandomAccessFile.html" title="interface in org.apache.derby.io">StorageRandomAccessFile</a>&nbsp;log,
                     int&nbsp;bufferSize)</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="writeLogRecord-int-long-byte:A-int-byte:A-int-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>writeLogRecord</h4>
<pre>public&nbsp;void&nbsp;writeLogRecord(int&nbsp;length,
                           long&nbsp;instant,
                           byte[]&nbsp;data,
                           int&nbsp;data_offset,
                           byte[]&nbsp;optional_data,
                           int&nbsp;optional_data_offset,
                           int&nbsp;optional_data_length)
                    throws <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a>,
                           java.io.IOException</pre>
<div class="block">Write a single log record to the stream.
 <p>
 For performance pass all parameters rather into a specialized routine
 rather than maintaining the writeInt, writeLong, and write interfaces
 that this class provides as a standard OutputStream.  It will make it
 harder to use other OutputStream implementations, but makes for less
 function calls and allows optimizations knowing when to switch buffers.
 <p>
 This routine handles all log records which are smaller than one log
 buffer.  If a log record is bigger than a log buffer it calls
 writeUnbufferedLogRecord().
 <p>
 The log record written will always look the same as if the following
 code had been executed:
     writeInt(length)
     writeLong(instant)
     write(data, data_offset, (length - optional_data_length) )

     if (optional_data_length != 0)
         write(optional_data, optional_data_offset, optional_data_length)

     writeInt(length)</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>length</code> - (data + optional_data) length bytes to write</dd>
<dd><code>instant</code> - the log address of this log record.</dd>
<dd><code>data</code> - "from" array to copy "data" portion of rec</dd>
<dd><code>data_offset</code> - offset in "data" to start copying from.</dd>
<dd><code>optional_data</code> - "from" array to copy "optional data" from</dd>
<dd><code>optional_data_offset</code> - offset in "optional_data" to start copy from</dd>
<dd><code>optional_data_length</code> - length of optional data to copy.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - Standard exception policy.</dd>
<dd><code>java.io.IOException</code></dd>
</dl>
</li>
</ul>
<a name="appendLogRecordToBuffer-byte:A-int-int-long-byte:A-int-byte:A-int-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>appendLogRecordToBuffer</h4>
<pre>private&nbsp;int&nbsp;appendLogRecordToBuffer(byte[]&nbsp;buff,
                                    int&nbsp;pos,
                                    int&nbsp;length,
                                    long&nbsp;instant,
                                    byte[]&nbsp;data,
                                    int&nbsp;data_offset,
                                    byte[]&nbsp;optional_data,
                                    int&nbsp;optional_data_offset,
                                    int&nbsp;optional_data_length)</pre>
<div class="block">Append a log record to a byte[]. Typically, the byte[] will be
 currentBuffer, but if a log record that is too big to fit in a
 buffer is added, buff will be a newly allocated byte[].</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>buff</code> - The byte[] the log record is appended to</dd>
<dd><code>pos</code> - The position in buff where the method will start to
 append to</dd>
<dd><code>length</code> - (data + optional_data) length bytes to write</dd>
<dd><code>instant</code> - the log address of this log record.</dd>
<dd><code>data</code> - "from" array to copy "data" portion of rec</dd>
<dd><code>data_offset</code> - offset in "data" to start copying from.</dd>
<dd><code>optional_data</code> - "from" array to copy "optional data" from</dd>
<dd><code>optional_data_offset</code> - offset in "optional_data" to start copy from</dd>
<dd><code>optional_data_length</code> - length of optional data to copy.</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFile.html#writeLogRecord-int-long-byte:A-int-byte:A-int-int-"><code>writeLogRecord(int, long, byte[], int, byte[], int, int)</code></a></dd>
</dl>
</li>
</ul>
<a name="writeInt-int-byte:A-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>writeInt</h4>
<pre>private final&nbsp;int&nbsp;writeInt(int&nbsp;i,
                           byte[]&nbsp;b,
                           int&nbsp;p)</pre>
</li>
</ul>
<a name="writeLong-long-byte:A-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>writeLong</h4>
<pre>private final&nbsp;int&nbsp;writeLong(long&nbsp;l,
                            byte[]&nbsp;b,
                            int&nbsp;p)</pre>
</li>
</ul>
<a name="writeInt-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>writeInt</h4>
<pre>public&nbsp;void&nbsp;writeInt(int&nbsp;i)</pre>
</li>
</ul>
<a name="writeLong-long-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>writeLong</h4>
<pre>public&nbsp;void&nbsp;writeLong(long&nbsp;l)</pre>
</li>
</ul>
<a name="write-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>write</h4>
<pre>public&nbsp;void&nbsp;write(int&nbsp;b)</pre>
</li>
</ul>
<a name="write-byte:A-int-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>write</h4>
<pre>public&nbsp;void&nbsp;write(byte[]&nbsp;b,
                  int&nbsp;off,
                  int&nbsp;len)</pre>
</li>
</ul>
<a name="flushDirtyBuffers--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>flushDirtyBuffers</h4>
<pre>protected&nbsp;void&nbsp;flushDirtyBuffers()
                          throws java.io.IOException</pre>
<div class="block">Write data from all dirty buffers into the log file.
 <p>
 A call for clients of LogAccessFile to insure that all privately buffered
 data has been writen to the file - so that reads on the file using one
 of the various scan classes will see
 all the data which has been writen to this point.
 <p>
 Note that this routine only "writes" the data to the file, this does not
 mean that the data has been synced to disk unless file was opened in
 WRITE SYNC mode(rws/rwd).  The only way to insure that is by calling
 is to call syncLogAccessFile() after this call in Non-WRITE sync mode(rw)
 
 <p>
 MT-Safe : parallel thereads can call this function, only one threads does
 the flush and the other threads waits for the one that is doing the flush to finish.
 Currently there are two possible threads that can call this function in parallel 
 1) A Thread that is doing the commit
 2) A Thread that is writing to the log and log buffers are full or
 a log records does not fit in a buffer. (Log Buffers
 full(switchLogBuffer() or a log record size that is greater than
 logbuffer size has to be writtern through writeToLog call directlty)
 Note: writeToLog() is not synchronized on the semaphore
 that is used to do  buffer management to allow writes 
 to the free buffers when flush is in progress.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
</dl>
</li>
</ul>
<a name="flushLogAccessFile--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>flushLogAccessFile</h4>
<pre>public&nbsp;void&nbsp;flushLogAccessFile()
                        throws java.io.IOException,
                               <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code></dd>
</dl>
</li>
</ul>
<a name="switchLogBuffer--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>switchLogBuffer</h4>
<pre>public&nbsp;void&nbsp;switchLogBuffer()
                     throws java.io.IOException,
                            <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Appends the current Buffer to the dirty Buffer list and assigns a free
 buffer to be the currrent active buffer . Flushing of the buffer
 to disk is delayed if there is a free buffer available. 
 dirty buffers will be  flushed to the disk   
 when  flushDirtyBuffers() is invoked by  a commit call 
 or when no more free buffers are available.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code></dd>
</dl>
</li>
</ul>
<a name="syncLogAccessFile--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>syncLogAccessFile</h4>
<pre>public&nbsp;void&nbsp;syncLogAccessFile()
                       throws java.io.IOException,
                              <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Guarantee all writes up to the last call to flushLogAccessFile on disk.
 <p>
 A call for clients of LogAccessFile to insure that all data written
 up to the last call to flushLogAccessFile() are written to disk.
 This call will not return until those writes have hit disk.
 <p>
 Note that this routine may block waiting for I/O to complete so 
 callers should limit the number of resource held locked while this
 operation is called.  It is expected that the caller
 Note that this routine only "writes" the data to the file, this does not
 mean that the data has been synced to disk.  The only way to insure that
 is to first call switchLogBuffer() and then follow by a call of sync().</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code></dd>
</dl>
</li>
</ul>
<a name="corrupt--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>corrupt</h4>
<pre>public&nbsp;void&nbsp;corrupt()
             throws java.io.IOException</pre>
<div class="block">The database is being marked corrupted, get rid of file pointer without
                writing out anything more.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
</dl>
</li>
</ul>
<a name="close--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>close</h4>
<pre>public&nbsp;void&nbsp;close()
           throws java.io.IOException,
                  <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code></dd>
</dl>
</li>
</ul>
<a name="setReplicationMasterRole-org.apache.derby.iapi.store.replication.master.MasterFactory-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setReplicationMasterRole</h4>
<pre>protected&nbsp;void&nbsp;setReplicationMasterRole(<a href="../../../../../../../org/apache/derby/iapi/store/replication/master/MasterFactory.html" title="interface in org.apache.derby.iapi.store.replication.master">MasterFactory</a>&nbsp;masterFac)</pre>
<div class="block">Make this LogAccessFile pass chunks of log records (byte[]) to
 the MasterFactory when the chunks are written to disk.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>masterFac</code> - The MasterFactory service responsible for
 controlling the master side replication behaviour.</dd>
</dl>
</li>
</ul>
<a name="stopReplicationMasterRole--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>stopReplicationMasterRole</h4>
<pre>protected&nbsp;void&nbsp;stopReplicationMasterRole()</pre>
<div class="block">Stop this LogAccessFile from passing chunks of log records to
 the MasterFactory.</div>
</li>
</ul>
<a name="setReplicationSlaveRole--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setReplicationSlaveRole</h4>
<pre>protected&nbsp;void&nbsp;setReplicationSlaveRole()</pre>
<div class="block">Method to put this LogAccessFile object in replication slave
 mode, effectively disabling checksum writes.

 Because checksums are received from the replication master, the
 slave can not be allowed to add it's own checksums - that would
 invalidate the checksums and would stop the database from
 recovering. Replication slave mode must therefore be set before
 LogAccessFile decides whether to write it's own checksums, and
 this method is therefore indirectly called from the constructor
 of this class by calling LogFactory.checkForReplication

 If replication slave mode for the database is stopped after
 this object has been created, checksums cannot be reenabled
 without creating a new instance of this class. That is
 conveniently handled as LogToFile.recover completes (which
 automatically happens once replication slave mode is no longer
 active)</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogToFile.html#checkForReplication-org.apache.derby.impl.store.raw.log.LogAccessFile-"><code>LogToFile.checkForReplication(org.apache.derby.impl.store.raw.log.LogAccessFile)</code></a></dd>
</dl>
</li>
</ul>
<a name="writeToLog-byte:A-int-int-long-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>writeToLog</h4>
<pre>private&nbsp;void&nbsp;writeToLog(byte[]&nbsp;b,
                        int&nbsp;off,
                        int&nbsp;len,
                        long&nbsp;highestInstant)
                 throws java.io.IOException</pre>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
</dl>
</li>
</ul>
<a name="reserveSpaceForChecksum-int-long-long-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>reserveSpaceForChecksum</h4>
<pre>protected&nbsp;long&nbsp;reserveSpaceForChecksum(int&nbsp;length,
                                       long&nbsp;logFileNumber,
                                       long&nbsp;currentPosition)
                                throws <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a>,
                                       java.io.IOException</pre>
<div class="block">reserve the space for the checksum log record in the log file.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>length</code> - the length of the log record to be written</dd>
<dd><code>logFileNumber</code> - current log file number</dd>
<dd><code>currentPosition</code> - current position in the log file.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the space that is needed to write a checksum log record.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code></dd>
<dd><code>java.io.IOException</code></dd>
</dl>
</li>
</ul>
<a name="writeChecksumLogRecord-byte:A-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>writeChecksumLogRecord</h4>
<pre>private&nbsp;void&nbsp;writeChecksumLogRecord(byte[]&nbsp;buffer)
                             throws java.io.IOException,
                                    <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Generate the checkum log record and write it into the log
 buffer. The checksum applies to all bytes from this checksum
 log record to the next one.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>buffer</code> - The byte[] the checksum is written to. The
 checksum is always written at the beginning of buffer.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code></dd>
</dl>
</li>
</ul>
<a name="getChecksumLogRecordSize--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getChecksumLogRecordSize</h4>
<pre>public&nbsp;int&nbsp;getChecksumLogRecordSize()</pre>
<div class="block">Return the length of a checksum record</div>
</li>
</ul>
<a name="writeEndMarker-int-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>writeEndMarker</h4>
<pre>protected&nbsp;void&nbsp;writeEndMarker(int&nbsp;marker)
                       throws java.io.IOException,
                              <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage">Built on Mon 2017-07-03 23:03:59+0530, from revision Unversioned directory</div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FlushedScanHandle.html" title="class in org.apache.derby.impl.store.raw.log"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogAccessFileBuffer.html" title="class in org.apache.derby.impl.store.raw.log"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../index.html?org/apache/derby/impl/store/raw/log/LogAccessFile.html" target="_top">Frames</a></li>
<li><a href="LogAccessFile.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Apache Derby V10.13 Internals - <i>Copyright &copy; 2004,2016 The Apache Software Foundation. All Rights Reserved.</i></small></p>
</body>
</html>
