<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_66) on Mon Jul 03 23:05:21 IST 2017 -->
<title>FileLogger (Apache Derby V10.13 Internals)</title>
<meta name="date" content="2017-07-03">
<link rel="stylesheet" type="text/css" href="../../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="FileLogger (Apache Derby V10.13 Internals)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10,"i7":10,"i8":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../org/apache/derby/impl/store/raw/log/D_LogToFile.html" title="class in org.apache.derby.impl.store.raw.log"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FlushedScan.html" title="class in org.apache.derby.impl.store.raw.log"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../index.html?org/apache/derby/impl/store/raw/log/FileLogger.html" target="_top">Frames</a></li>
<li><a href="FileLogger.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.derby.impl.store.raw.log</div>
<h2 title="Class FileLogger" class="title">Class FileLogger</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.apache.derby.impl.store.raw.log.FileLogger</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/Logger.html" title="interface in org.apache.derby.iapi.store.raw.log">Logger</a></dd>
</dl>
<hr>
<br>
<pre>public class <span class="typeNameLabel">FileLogger</span>
extends java.lang.Object
implements <a href="../../../../../../../org/apache/derby/iapi/store/raw/log/Logger.html" title="interface in org.apache.derby.iapi.store.raw.log">Logger</a></pre>
<div class="block">Write log records to a log file as a stream
        (ie. log records added to the end of the file, no concept of pages).
<P>
        The format of a log record that is not a compensation operation is
        <PRE></div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogRecord.html" title="class in org.apache.derby.impl.store.raw.log"><code>LogRecord</code></a></dd>
<table cellpadding=2 cellspacing=2><tr><td>Format ID</td><td>no formatId, format is implied by the log file format and the
		log record content.</td></tr>no formatId, format is implied by the log file format and the
	log record content.</td></tr>
<tr><td>Purpose</td><td>the log record and optional data</td></tr>undo a previous log record</td></tr>
<tr><td>Upgrade</td><td></td></tr></td></tr>
<tr><td>Disk Layout</td><td>Log Record
			(see org.apache.derby.impl.store.raw.log.LogRecord)
		length(int)	length of optional data
		optionalData(byte[length]) optional data written by the log record</td></tr>Log Record that contains the compenstation operation
			(see org.apache.derby.impl.store.raw.log.LogRecord)
		undoInstant(long) the log instant of the operation that is to be rolled back
			The undo instant is logically part of the LogRecord but is written
			by the logger because it is used and controlled by the rollback
			code but not by the log operation.
		There is no optional data in a compensation operation, all data
		necessary for the rollback must be stored in the operation being
		undone.</td></tr></table></dt>

</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected byte[]</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#encryptionBuffer">encryptionBuffer</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogToFile.html" title="class in org.apache.derby.impl.store.raw.log">LogToFile</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#logFactory">logFactory</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/iapi/services/io/FormatIdOutputStream.html" title="class in org.apache.derby.iapi.services.io">FormatIdOutputStream</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#logicalOut">logicalOut</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/iapi/services/io/ArrayInputStream.html" title="class in org.apache.derby.iapi.services.io">ArrayInputStream</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#logIn">logIn</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/iapi/services/io/DynamicByteArrayOutputStream.html" title="class in org.apache.derby.iapi.services.io">DynamicByteArrayOutputStream</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#logOutputBuffer">logOutputBuffer</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogRecord.html" title="class in org.apache.derby.impl.store.raw.log">LogRecord</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#logRecord">logRecord</a></span></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#FileLogger-org.apache.derby.impl.store.raw.log.LogToFile-">FileLogger</a></span>(<a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogToFile.html" title="class in org.apache.derby.impl.store.raw.log">LogToFile</a>&nbsp;logFactory)</code>
<div class="block">Make a new Logger with its own log record buffers
                MT - not needed for constructor</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#close--">close</a></span>()</code>
<div class="block">Close the logger.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#flush-org.apache.derby.iapi.store.raw.log.LogInstant-">flush</a></span>(<a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a>&nbsp;where)</code>
<div class="block">Flush the log up to the given log instant.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#flushAll--">flushAll</a></span>()</code>
<div class="block">Flush all outstanding log to disk.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#logAndDo-org.apache.derby.iapi.store.raw.xact.RawTransaction-org.apache.derby.iapi.store.raw.Loggable-">logAndDo</a></span>(<a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/RawTransaction.html" title="class in org.apache.derby.iapi.store.raw.xact">RawTransaction</a>&nbsp;xact,
        <a href="../../../../../../../org/apache/derby/iapi/store/raw/Loggable.html" title="interface in org.apache.derby.iapi.store.raw">Loggable</a>&nbsp;operation)</code>
<div class="block">Writes out a log record to the log stream, and call its doMe method to
                apply the change to the rawStore.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#logAndUndo-org.apache.derby.iapi.store.raw.xact.RawTransaction-org.apache.derby.iapi.store.raw.Compensation-org.apache.derby.iapi.store.raw.log.LogInstant-org.apache.derby.iapi.services.io.LimitObjectInput-">logAndUndo</a></span>(<a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/RawTransaction.html" title="class in org.apache.derby.iapi.store.raw.xact">RawTransaction</a>&nbsp;xact,
          <a href="../../../../../../../org/apache/derby/iapi/store/raw/Compensation.html" title="interface in org.apache.derby.iapi.store.raw">Compensation</a>&nbsp;compensation,
          <a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a>&nbsp;undoInstant,
          <a href="../../../../../../../org/apache/derby/iapi/services/io/LimitObjectInput.html" title="interface in org.apache.derby.iapi.services.io">LimitObjectInput</a>&nbsp;in)</code>
<div class="block">Writes out a compensation log record to the log stream, and call its
                doMe method to undo the change of a previous log operation.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>protected <a href="../../../../../../../org/apache/derby/iapi/store/raw/Loggable.html" title="interface in org.apache.derby.iapi.store.raw">Loggable</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#readLogRecord-org.apache.derby.impl.store.raw.log.StreamLogScan-int-">readLogRecord</a></span>(<a href="../../../../../../../org/apache/derby/impl/store/raw/log/StreamLogScan.html" title="interface in org.apache.derby.impl.store.raw.log">StreamLogScan</a>&nbsp;scan,
             int&nbsp;size)</code>
<div class="block">Read the next log record from the scan.</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>protected long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#redo-org.apache.derby.iapi.store.raw.xact.RawTransaction-org.apache.derby.iapi.store.raw.xact.TransactionFactory-org.apache.derby.impl.store.raw.log.StreamLogScan-long-long-">redo</a></span>(<a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/RawTransaction.html" title="class in org.apache.derby.iapi.store.raw.xact">RawTransaction</a>&nbsp;recoveryTransaction,
    <a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/TransactionFactory.html" title="interface in org.apache.derby.iapi.store.raw.xact">TransactionFactory</a>&nbsp;transFactory,
    <a href="../../../../../../../org/apache/derby/impl/store/raw/log/StreamLogScan.html" title="interface in org.apache.derby.impl.store.raw.log">StreamLogScan</a>&nbsp;redoScan,
    long&nbsp;redoLWM,
    long&nbsp;ttabInstant)</code>
<div class="block">Recovery Redo loop.</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#reprepare-org.apache.derby.iapi.store.raw.xact.RawTransaction-org.apache.derby.iapi.store.raw.xact.TransactionId-org.apache.derby.iapi.store.raw.log.LogInstant-org.apache.derby.iapi.store.raw.log.LogInstant-">reprepare</a></span>(<a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/RawTransaction.html" title="class in org.apache.derby.iapi.store.raw.xact">RawTransaction</a>&nbsp;t,
         <a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/TransactionId.html" title="interface in org.apache.derby.iapi.store.raw.xact">TransactionId</a>&nbsp;prepareId,
         <a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a>&nbsp;prepareStopAt,
         <a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a>&nbsp;prepareStartAt)</code>
<div class="block">During recovery re-prepare a transaction.</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FileLogger.html#undo-org.apache.derby.iapi.store.raw.xact.RawTransaction-org.apache.derby.iapi.store.raw.xact.TransactionId-org.apache.derby.iapi.store.raw.log.LogInstant-org.apache.derby.iapi.store.raw.log.LogInstant-">undo</a></span>(<a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/RawTransaction.html" title="class in org.apache.derby.iapi.store.raw.xact">RawTransaction</a>&nbsp;t,
    <a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/TransactionId.html" title="interface in org.apache.derby.iapi.store.raw.xact">TransactionId</a>&nbsp;undoId,
    <a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a>&nbsp;undoStopAt,
    <a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a>&nbsp;undoStartAt)</code>
<div class="block">Undo a part of or the entire transaction.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="logRecord">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>logRecord</h4>
<pre>private&nbsp;<a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogRecord.html" title="class in org.apache.derby.impl.store.raw.log">LogRecord</a> logRecord</pre>
</li>
</ul>
<a name="encryptionBuffer">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>encryptionBuffer</h4>
<pre>protected&nbsp;byte[] encryptionBuffer</pre>
</li>
</ul>
<a name="logOutputBuffer">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>logOutputBuffer</h4>
<pre>private&nbsp;<a href="../../../../../../../org/apache/derby/iapi/services/io/DynamicByteArrayOutputStream.html" title="class in org.apache.derby.iapi.services.io">DynamicByteArrayOutputStream</a> logOutputBuffer</pre>
</li>
</ul>
<a name="logicalOut">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>logicalOut</h4>
<pre>private&nbsp;<a href="../../../../../../../org/apache/derby/iapi/services/io/FormatIdOutputStream.html" title="class in org.apache.derby.iapi.services.io">FormatIdOutputStream</a> logicalOut</pre>
</li>
</ul>
<a name="logIn">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>logIn</h4>
<pre>private&nbsp;<a href="../../../../../../../org/apache/derby/iapi/services/io/ArrayInputStream.html" title="class in org.apache.derby.iapi.services.io">ArrayInputStream</a> logIn</pre>
</li>
</ul>
<a name="logFactory">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>logFactory</h4>
<pre>private&nbsp;<a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogToFile.html" title="class in org.apache.derby.impl.store.raw.log">LogToFile</a> logFactory</pre>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="FileLogger-org.apache.derby.impl.store.raw.log.LogToFile-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>FileLogger</h4>
<pre>public&nbsp;FileLogger(<a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogToFile.html" title="class in org.apache.derby.impl.store.raw.log">LogToFile</a>&nbsp;logFactory)</pre>
<div class="block">Make a new Logger with its own log record buffers
                MT - not needed for constructor</div>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="close--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>close</h4>
<pre>public&nbsp;void&nbsp;close()
           throws java.io.IOException</pre>
<div class="block">Close the logger.
                MT - caller provide synchronization
                (RESOLVE: not called by anyone ??)</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
</dl>
</li>
</ul>
<a name="logAndDo-org.apache.derby.iapi.store.raw.xact.RawTransaction-org.apache.derby.iapi.store.raw.Loggable-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>logAndDo</h4>
<pre>public&nbsp;<a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a>&nbsp;logAndDo(<a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/RawTransaction.html" title="class in org.apache.derby.iapi.store.raw.xact">RawTransaction</a>&nbsp;xact,
                           <a href="../../../../../../../org/apache/derby/iapi/store/raw/Loggable.html" title="interface in org.apache.derby.iapi.store.raw">Loggable</a>&nbsp;operation)
                    throws <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Writes out a log record to the log stream, and call its doMe method to
                apply the change to the rawStore.
                <BR>Any optional data the doMe method need is first written to the log
                stream using operation.writeOptionalData, then whatever is written to
                the log stream is passed back to the operation for the doMe method.

                <P>MT - there could be multiple threads running in the same raw
                transactions and they can be calling the same logger to log different
                log operations.  This whole method is synchronized to make sure log
                records are logged one at a time.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/Logger.html#logAndDo-org.apache.derby.iapi.store.raw.xact.RawTransaction-org.apache.derby.iapi.store.raw.Loggable-">logAndDo</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/Logger.html" title="interface in org.apache.derby.iapi.store.raw.log">Logger</a></code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>xact</code> - the transaction logging the change</dd>
<dd><code>operation</code> - the log operation</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the instant in the log that can be used to identify the log
                record</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - Derby Standard error policy</dd>
</dl>
</li>
</ul>
<a name="logAndUndo-org.apache.derby.iapi.store.raw.xact.RawTransaction-org.apache.derby.iapi.store.raw.Compensation-org.apache.derby.iapi.store.raw.log.LogInstant-org.apache.derby.iapi.services.io.LimitObjectInput-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>logAndUndo</h4>
<pre>public&nbsp;<a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a>&nbsp;logAndUndo(<a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/RawTransaction.html" title="class in org.apache.derby.iapi.store.raw.xact">RawTransaction</a>&nbsp;xact,
                             <a href="../../../../../../../org/apache/derby/iapi/store/raw/Compensation.html" title="interface in org.apache.derby.iapi.store.raw">Compensation</a>&nbsp;compensation,
                             <a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a>&nbsp;undoInstant,
                             <a href="../../../../../../../org/apache/derby/iapi/services/io/LimitObjectInput.html" title="interface in org.apache.derby.iapi.services.io">LimitObjectInput</a>&nbsp;in)
                      throws <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Writes out a compensation log record to the log stream, and call its
                doMe method to undo the change of a previous log operation.

                <P>MT - Not needed. A transaction must be single threaded thru undo, each
                RawTransaction has its own logger, therefore no need to synchronize.
                The RawTransaction must handle synchronizing with multiple threads
                during rollback.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/Logger.html#logAndUndo-org.apache.derby.iapi.store.raw.xact.RawTransaction-org.apache.derby.iapi.store.raw.Compensation-org.apache.derby.iapi.store.raw.log.LogInstant-org.apache.derby.iapi.services.io.LimitObjectInput-">logAndUndo</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/Logger.html" title="interface in org.apache.derby.iapi.store.raw.log">Logger</a></code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>xact</code> - the transaction logging the change</dd>
<dd><code>compensation</code> - the compensation log operation</dd>
<dd><code>undoInstant</code> - the log instant of the operation that is to be
                rolled back</dd>
<dd><code>in</code> - optional data input for the compenastion doMe method</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the instant in the log that can be used to identify the log
                record</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - Derby Standard error policy</dd>
</dl>
</li>
</ul>
<a name="flush-org.apache.derby.iapi.store.raw.log.LogInstant-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>flush</h4>
<pre>public&nbsp;void&nbsp;flush(<a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a>&nbsp;where)
           throws <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Flush the log up to the given log instant.

                <P>MT - not needed, wrapper method</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/Logger.html#flush-org.apache.derby.iapi.store.raw.log.LogInstant-">flush</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/Logger.html" title="interface in org.apache.derby.iapi.store.raw.log">Logger</a></code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>where</code> - flush log up to here</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - cannot sync log file</dd>
</dl>
</li>
</ul>
<a name="flushAll--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>flushAll</h4>
<pre>public&nbsp;void&nbsp;flushAll()
              throws <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Flush all outstanding log to disk.

                <P>MT - not needed, wrapper method</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/Logger.html#flushAll--">flushAll</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/Logger.html" title="interface in org.apache.derby.iapi.store.raw.log">Logger</a></code></dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - cannot sync log file</dd>
</dl>
</li>
</ul>
<a name="reprepare-org.apache.derby.iapi.store.raw.xact.RawTransaction-org.apache.derby.iapi.store.raw.xact.TransactionId-org.apache.derby.iapi.store.raw.log.LogInstant-org.apache.derby.iapi.store.raw.log.LogInstant-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>reprepare</h4>
<pre>public&nbsp;void&nbsp;reprepare(<a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/RawTransaction.html" title="class in org.apache.derby.iapi.store.raw.xact">RawTransaction</a>&nbsp;t,
                      <a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/TransactionId.html" title="interface in org.apache.derby.iapi.store.raw.xact">TransactionId</a>&nbsp;prepareId,
                      <a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a>&nbsp;prepareStopAt,
                      <a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a>&nbsp;prepareStartAt)
               throws <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">During recovery re-prepare a transaction.
 <p>
 After redo() and undo(), this routine is called on all outstanding 
 in-doubt (prepared) transactions.  This routine re-acquires all 
 logical write locks for operations in the xact, and then modifies
 the transaction table entry to make the transaction look as if it
 had just been prepared following startup after recovery.
 <p></div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/Logger.html#reprepare-org.apache.derby.iapi.store.raw.xact.RawTransaction-org.apache.derby.iapi.store.raw.xact.TransactionId-org.apache.derby.iapi.store.raw.log.LogInstant-org.apache.derby.iapi.store.raw.log.LogInstant-">reprepare</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/Logger.html" title="interface in org.apache.derby.iapi.store.raw.log">Logger</a></code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>t</code> - is the transaction performing the re-prepare</dd>
<dd><code>prepareId</code> - is the transaction ID to be re-prepared</dd>
<dd><code>prepareStopAt</code> - is where the log instant (inclusive) where the 
                          re-prepare should stop.</dd>
<dd><code>prepareStartAt</code> - is the log instant (inclusive) where re-prepare 
                          should begin, this is normally the log instant 
                          of the last log record of the transaction that 
                          is to be re-prepare.  If null, then re-prepare 
                          starts from the end of the log.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - Standard exception policy.</dd>
</dl>
</li>
</ul>
<a name="undo-org.apache.derby.iapi.store.raw.xact.RawTransaction-org.apache.derby.iapi.store.raw.xact.TransactionId-org.apache.derby.iapi.store.raw.log.LogInstant-org.apache.derby.iapi.store.raw.log.LogInstant-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>undo</h4>
<pre>public&nbsp;void&nbsp;undo(<a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/RawTransaction.html" title="class in org.apache.derby.iapi.store.raw.xact">RawTransaction</a>&nbsp;t,
                 <a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/TransactionId.html" title="interface in org.apache.derby.iapi.store.raw.xact">TransactionId</a>&nbsp;undoId,
                 <a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a>&nbsp;undoStopAt,
                 <a href="../../../../../../../org/apache/derby/iapi/store/raw/log/LogInstant.html" title="interface in org.apache.derby.iapi.store.raw.log">LogInstant</a>&nbsp;undoStartAt)
          throws <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></pre>
<div class="block">Undo a part of or the entire transaction.  Begin rolling back the log
                record at undoStartAt and stopping at (inclusive) the log record at
                undoStopAt.

                <P>MT - Not needed. A transaction must be single threaded thru undo, 
        each RawTransaction has its own logger, therefore no need to 
        synchronize.  The RawTransaction must handle synchronizing with 
        multiple threads during rollback.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/Logger.html#undo-org.apache.derby.iapi.store.raw.xact.RawTransaction-org.apache.derby.iapi.store.raw.xact.TransactionId-org.apache.derby.iapi.store.raw.log.LogInstant-org.apache.derby.iapi.store.raw.log.LogInstant-">undo</a></code>&nbsp;in interface&nbsp;<code><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/Logger.html" title="interface in org.apache.derby.iapi.store.raw.log">Logger</a></code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>t</code> - the transaction that needs to be rolled back</dd>
<dd><code>undoId</code> - the transaction ID</dd>
<dd><code>undoStopAt</code> - the last log record that should be rolled back</dd>
<dd><code>undoStartAt</code> - the first log record that should be rolled back</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - Standard Derby error policy</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../org/apache/derby/iapi/store/raw/log/Logger.html#undo-org.apache.derby.iapi.store.raw.xact.RawTransaction-org.apache.derby.iapi.store.raw.xact.TransactionId-org.apache.derby.iapi.store.raw.log.LogInstant-org.apache.derby.iapi.store.raw.log.LogInstant-"><code>Logger.undo(org.apache.derby.iapi.store.raw.xact.RawTransaction, org.apache.derby.iapi.store.raw.xact.TransactionId, org.apache.derby.iapi.store.raw.log.LogInstant, org.apache.derby.iapi.store.raw.log.LogInstant)</code></a></dd>
</dl>
</li>
</ul>
<a name="redo-org.apache.derby.iapi.store.raw.xact.RawTransaction-org.apache.derby.iapi.store.raw.xact.TransactionFactory-org.apache.derby.impl.store.raw.log.StreamLogScan-long-long-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>redo</h4>
<pre>protected&nbsp;long&nbsp;redo(<a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/RawTransaction.html" title="class in org.apache.derby.iapi.store.raw.xact">RawTransaction</a>&nbsp;recoveryTransaction,
                    <a href="../../../../../../../org/apache/derby/iapi/store/raw/xact/TransactionFactory.html" title="interface in org.apache.derby.iapi.store.raw.xact">TransactionFactory</a>&nbsp;transFactory,
                    <a href="../../../../../../../org/apache/derby/impl/store/raw/log/StreamLogScan.html" title="interface in org.apache.derby.impl.store.raw.log">StreamLogScan</a>&nbsp;redoScan,
                    long&nbsp;redoLWM,
                    long&nbsp;ttabInstant)
             throws java.io.IOException,
                    <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a>,
                    java.lang.ClassNotFoundException</pre>
<div class="block">Recovery Redo loop.

                <P> The log stream is scanned from the beginning (or
                from the undo low water mark of a checkpoint) forward until the end.
                The purpose of the redo pass is to repeat history, i.e, to repeat
                exactly the same set of changes the rawStore went thru right before it
                stopped.   With each log record that is encountered in the redo pass:
                <OL>
                <LI>if it isFirst(), then the transaction factory is called upon to
                    create a new transaction object.
                <LI>if it needsRedo(), its doMe() is called (if it is a compensation
                    operation, then the undoable operation needs to be created first
            before the doMe is called).
                <LI>if it isComplete(), then the transaction object is closed.
                </OL>

                <P> MT - caller provides synchronization</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>transFactory</code> - - the transaction factory</dd>
<dd><code>redoLWM</code> - - if checkpoint seen, starting from this point
                                  on, apply redo if necessary</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the log instant of the next log record (or the instant just
                after the last log record).  This is used to determine where the log
                truly ends</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - Standard Derby error policy</dd>
<dd><code>java.io.IOException</code> - error reading log file</dd>
<dd><code>java.lang.ClassNotFoundException</code> - log file corrupted</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../org/apache/derby/impl/store/raw/log/LogToFile.html#recover-org.apache.derby.iapi.store.raw.data.DataFactory-org.apache.derby.iapi.store.raw.xact.TransactionFactory-"><code>LogToFile.recover(org.apache.derby.iapi.store.raw.data.DataFactory, org.apache.derby.iapi.store.raw.xact.TransactionFactory)</code></a></dd>
</dl>
</li>
</ul>
<a name="readLogRecord-org.apache.derby.impl.store.raw.log.StreamLogScan-int-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>readLogRecord</h4>
<pre>protected&nbsp;<a href="../../../../../../../org/apache/derby/iapi/store/raw/Loggable.html" title="interface in org.apache.derby.iapi.store.raw">Loggable</a>&nbsp;readLogRecord(<a href="../../../../../../../org/apache/derby/impl/store/raw/log/StreamLogScan.html" title="interface in org.apache.derby.impl.store.raw.log">StreamLogScan</a>&nbsp;scan,
                                 int&nbsp;size)
                          throws java.io.IOException,
                                 <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a>,
                                 java.lang.ClassNotFoundException</pre>
<div class="block">Read the next log record from the scan.

                <P>MT - caller must provide synchronization (right now, it is only
                called in recovery to find the checkpoint log record.  When this method
                is called by a more general audience, MT must be revisited).</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>scan</code> - an opened log scan</dd>
<dd><code>size</code> - estimated size of the log record</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the log operation that is the next in the scan, or null if no
                more log operation in the log scan</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code> - Error reading the log file</dd>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - Standard Derby error policy</dd>
<dd><code>java.lang.ClassNotFoundException</code> - log corrupted</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage">Built on Mon 2017-07-03 23:03:59+0530, from revision Unversioned directory</div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../org/apache/derby/impl/store/raw/log/D_LogToFile.html" title="class in org.apache.derby.impl.store.raw.log"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../../org/apache/derby/impl/store/raw/log/FlushedScan.html" title="class in org.apache.derby.impl.store.raw.log"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../index.html?org/apache/derby/impl/store/raw/log/FileLogger.html" target="_top">Frames</a></li>
<li><a href="FileLogger.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Apache Derby V10.13 Internals - <i>Copyright &copy; 2004,2016 The Apache Software Foundation. All Rights Reserved.</i></small></p>
</body>
</html>
