<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_66) on Mon Jul 03 23:05:09 IST 2017 -->
<title>Undoable (Apache Derby V10.13 Internals)</title>
<meta name="date" content="2017-07-03">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="Undoable (Apache Derby V10.13 Internals)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../org/apache/derby/iapi/store/raw/Transaction.html" title="interface in org.apache.derby.iapi.store.raw"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../org/apache/derby/iapi/store/raw/UndoHandler.html" title="interface in org.apache.derby.iapi.store.raw"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/apache/derby/iapi/store/raw/Undoable.html" target="_top">Frames</a></li>
<li><a href="Undoable.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.derby.iapi.store.raw</div>
<h2 title="Interface Undoable" class="title">Interface Undoable</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Superinterfaces:</dt>
<dd>java.io.Externalizable, <a href="../../../../../../org/apache/derby/iapi/services/io/Formatable.html" title="interface in org.apache.derby.iapi.services.io">Formatable</a>, <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html" title="interface in org.apache.derby.iapi.store.raw">Loggable</a>, java.io.Serializable, <a href="../../../../../../org/apache/derby/iapi/services/io/TypedFormat.html" title="interface in org.apache.derby.iapi.services.io">TypedFormat</a></dd>
</dl>
<dl>
<dt>All Known Subinterfaces:</dt>
<dd><a href="../../../../../../org/apache/derby/iapi/store/raw/LogicalUndoable.html" title="interface in org.apache.derby.iapi.store.raw">LogicalUndoable</a></dd>
</dl>
<dl>
<dt>All Known Implementing Classes:</dt>
<dd><a href="../../../../../../org/apache/derby/impl/store/raw/data/AllocPageOperation.html" title="class in org.apache.derby.impl.store.raw.data">AllocPageOperation</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/ChainAllocPageOperation.html" title="class in org.apache.derby.impl.store.raw.data">ChainAllocPageOperation</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/CompressSpacePageOperation.html" title="class in org.apache.derby.impl.store.raw.data">CompressSpacePageOperation</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/CompressSpacePageOperation10_2.html" title="class in org.apache.derby.impl.store.raw.data">CompressSpacePageOperation10_2</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/ContainerOperation.html" title="class in org.apache.derby.impl.store.raw.data">ContainerOperation</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/CopyRowsOperation.html" title="class in org.apache.derby.impl.store.raw.data">CopyRowsOperation</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/DeleteOperation.html" title="class in org.apache.derby.impl.store.raw.data">DeleteOperation</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/EncryptContainerOperation.html" title="class in org.apache.derby.impl.store.raw.data">EncryptContainerOperation</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/InitPageOperation.html" title="class in org.apache.derby.impl.store.raw.data">InitPageOperation</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/InsertOperation.html" title="class in org.apache.derby.impl.store.raw.data">InsertOperation</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/InvalidatePageOperation.html" title="class in org.apache.derby.impl.store.raw.data">InvalidatePageOperation</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/LogicalPageOperation.html" title="class in org.apache.derby.impl.store.raw.data">LogicalPageOperation</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/PhysicalPageOperation.html" title="class in org.apache.derby.impl.store.raw.data">PhysicalPageOperation</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/PurgeOperation.html" title="class in org.apache.derby.impl.store.raw.data">PurgeOperation</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/RemoveFileOperation.html" title="class in org.apache.derby.impl.store.raw.data">RemoveFileOperation</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/UpdateFieldOperation.html" title="class in org.apache.derby.impl.store.raw.data">UpdateFieldOperation</a>, <a href="../../../../../../org/apache/derby/impl/store/raw/data/UpdateOperation.html" title="class in org.apache.derby.impl.store.raw.data">UpdateOperation</a></dd>
</dl>
<hr>
<br>
<pre>public interface <span class="typeNameLabel">Undoable</span>
extends <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html" title="interface in org.apache.derby.iapi.store.raw">Loggable</a></pre>
<div class="block">An Undoable operation is an operation that changed the state of the RawStore
        in the context of a transaction and this change can be rolled back.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../org/apache/derby/iapi/store/raw/Transaction.html#logAndDo-org.apache.derby.iapi.store.raw.Loggable-"><code>Transaction.logAndDo(org.apache.derby.iapi.store.raw.Loggable)</code></a>, 
<a href="../../../../../../org/apache/derby/iapi/store/raw/Compensation.html" title="interface in org.apache.derby.iapi.store.raw"><code>Compensation</code></a></dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<ul class="blockList">
<li class="blockList"><a name="fields.inherited.from.class.org.apache.derby.iapi.store.raw.Loggable">
<!--   -->
</a>
<h3>Fields inherited from interface&nbsp;org.apache.derby.iapi.store.raw.<a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html" title="interface in org.apache.derby.iapi.store.raw">Loggable</a></h3>
<code><a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#ABORT">ABORT</a>, <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#BI_LOG">BI_LOG</a>, <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#CHECKSUM">CHECKSUM</a>, <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#COMMIT">COMMIT</a>, <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#COMPENSATION">COMPENSATION</a>, <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#FILE_RESOURCE">FILE_RESOURCE</a>, <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#FIRST">FIRST</a>, <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#LAST">LAST</a>, <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#PREPARE">PREPARE</a>, <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#RAWSTORE">RAWSTORE</a>, <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#XA_NEEDLOCK">XA_NEEDLOCK</a></code></li>
</ul>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code><a href="../../../../../../org/apache/derby/iapi/store/raw/Compensation.html" title="interface in org.apache.derby.iapi.store.raw">Compensation</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/derby/iapi/store/raw/Undoable.html#generateUndo-org.apache.derby.iapi.store.raw.Transaction-org.apache.derby.iapi.services.io.LimitObjectInput-">generateUndo</a></span>(<a href="../../../../../../org/apache/derby/iapi/store/raw/Transaction.html" title="interface in org.apache.derby.iapi.store.raw">Transaction</a>&nbsp;xact,
            <a href="../../../../../../org/apache/derby/iapi/services/io/LimitObjectInput.html" title="interface in org.apache.derby.iapi.services.io">LimitObjectInput</a>&nbsp;in)</code>
<div class="block">Generate a loggable which will undo this change, using the optional
                input if necessary.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.org.apache.derby.iapi.store.raw.Loggable">
<!--   -->
</a>
<h3>Methods inherited from interface&nbsp;org.apache.derby.iapi.store.raw.<a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html" title="interface in org.apache.derby.iapi.store.raw">Loggable</a></h3>
<code><a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#doMe-org.apache.derby.iapi.store.raw.Transaction-org.apache.derby.iapi.store.raw.log.LogInstant-org.apache.derby.iapi.services.io.LimitObjectInput-">doMe</a>, <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#getPreparedLog--">getPreparedLog</a>, <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#group--">group</a>, <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#needsRedo-org.apache.derby.iapi.store.raw.Transaction-">needsRedo</a>, <a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#releaseResource-org.apache.derby.iapi.store.raw.Transaction-">releaseResource</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.io.Externalizable">
<!--   -->
</a>
<h3>Methods inherited from interface&nbsp;java.io.Externalizable</h3>
<code>readExternal, writeExternal</code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.org.apache.derby.iapi.services.io.TypedFormat">
<!--   -->
</a>
<h3>Methods inherited from interface&nbsp;org.apache.derby.iapi.services.io.<a href="../../../../../../org/apache/derby/iapi/services/io/TypedFormat.html" title="interface in org.apache.derby.iapi.services.io">TypedFormat</a></h3>
<code><a href="../../../../../../org/apache/derby/iapi/services/io/TypedFormat.html#getTypeFormatId--">getTypeFormatId</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="generateUndo-org.apache.derby.iapi.store.raw.Transaction-org.apache.derby.iapi.services.io.LimitObjectInput-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>generateUndo</h4>
<pre><a href="../../../../../../org/apache/derby/iapi/store/raw/Compensation.html" title="interface in org.apache.derby.iapi.store.raw">Compensation</a>&nbsp;generateUndo(<a href="../../../../../../org/apache/derby/iapi/store/raw/Transaction.html" title="interface in org.apache.derby.iapi.store.raw">Transaction</a>&nbsp;xact,
                          <a href="../../../../../../org/apache/derby/iapi/services/io/LimitObjectInput.html" title="interface in org.apache.derby.iapi.services.io">LimitObjectInput</a>&nbsp;in)
                   throws <a href="../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a>,
                          java.io.IOException</pre>
<div class="block">Generate a loggable which will undo this change, using the optional
                input if necessary.

                <P><B>NOTE</B><BR>Any logical undo logic must be hidden behind generateUndo.
                During recovery redo, it should not depend on any logical undo logic.

                <P>
                There are 3 ways to implement a redo-only log record:
                <NL>
                <LI>Make the log record a Loggable instead of an Undoable, this is the
                cleanest method.
                <LI>If you want to extend a log operation class that is an Undoable,
                you can then either have generateUndo return null - this is preferred -
                (the log operation's undoMe should never be called, so you can put a
                null body there if the super class you are extending does not implement
                a undoMe).
                <LI>Or, have undoMe do nothing - this is least preferred.
                </NL>

                <P>Any resource (e.g., latched page) that is needed for the
                undoable.undoMe() must be acquired in undoable.generateUndo().
                Moreover, that resource must be identified in the compensation
                operation, and reacquired in the compensation.needsRedo() method during
                recovery redo.
                <BR><B>If you do write your own generateUndo or needsRedo, any
                resource you latch or acquire, you must release them in
                Compensation.doMe() or in Compensation.releaseResource().</B>

                <P> To write a generateUndo operation, find the object that needs to be
                rolled back.  Assuming that it is a page, latch it, put together a
                Compensation operation with the undoOp set to this operation, and save
                the page number in the compensation operation, then
                return the Compensation operation to the logging system.

                <P>
                The sequence of events in a rollback of a undoable operation is
                <NL>
                <LI> The logging system calls undoable.generateUndo.  If this returns
                null, then there is nothing to undo.
                <LI> If generateUndo returns a Compensation operation, then the logging
                system will log the Compensation log record and call
                Compenstation.doMe().  (Hopefully, this just calls the undoable's
                undoMe)
                <LI> After the Compensation operation has been applied, the logging
                system will call compensation.releaseResource(). If you do overwrite a
                super class's releaseResource(), it would be prudent to call
                super.releaseResource() first.
                </NL>

                <P> The available() method of in indicates how much data can be read, i.e.
                how much was originally written.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>xact</code> - the transaction doing the rollback</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the compensation operation that will rollback this change, or
                null if nothing to undo.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code> - Can be thrown by any of the methods of ObjectInput.</dd>
<dd><code><a href="../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - Standard Derby policy.</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#releaseResource-org.apache.derby.iapi.store.raw.Transaction-"><code>Loggable.releaseResource(org.apache.derby.iapi.store.raw.Transaction)</code></a>, 
<a href="../../../../../../org/apache/derby/iapi/store/raw/Loggable.html#needsRedo-org.apache.derby.iapi.store.raw.Transaction-"><code>Loggable.needsRedo(org.apache.derby.iapi.store.raw.Transaction)</code></a></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage">Built on Mon 2017-07-03 23:03:59+0530, from revision Unversioned directory</div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../org/apache/derby/iapi/store/raw/Transaction.html" title="interface in org.apache.derby.iapi.store.raw"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../org/apache/derby/iapi/store/raw/UndoHandler.html" title="interface in org.apache.derby.iapi.store.raw"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/apache/derby/iapi/store/raw/Undoable.html" target="_top">Frames</a></li>
<li><a href="Undoable.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Apache Derby V10.13 Internals - <i>Copyright &copy; 2004,2016 The Apache Software Foundation. All Rights Reserved.</i></small></p>
</body>
</html>
