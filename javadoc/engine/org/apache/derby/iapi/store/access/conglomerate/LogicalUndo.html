<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_66) on Mon Jul 03 23:05:20 IST 2017 -->
<title>LogicalUndo (Apache Derby V10.13 Internals)</title>
<meta name="date" content="2017-07-03">
<link rel="stylesheet" type="text/css" href="../../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="LogicalUndo (Apache Derby V10.13 Internals)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../org/apache/derby/iapi/store/access/conglomerate/ConglomerateFactory.html" title="interface in org.apache.derby.iapi.store.access.conglomerate"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../../org/apache/derby/iapi/store/access/conglomerate/MethodFactory.html" title="interface in org.apache.derby.iapi.store.access.conglomerate"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../index.html?org/apache/derby/iapi/store/access/conglomerate/LogicalUndo.html" target="_top">Frames</a></li>
<li><a href="LogicalUndo.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.derby.iapi.store.access.conglomerate</div>
<h2 title="Interface LogicalUndo" class="title">Interface LogicalUndo</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Known Implementing Classes:</dt>
<dd><a href="../../../../../../../org/apache/derby/impl/store/access/btree/index/B2IUndo.html" title="class in org.apache.derby.impl.store.access.btree.index">B2IUndo</a></dd>
</dl>
<hr>
<br>
<pre>public interface <span class="typeNameLabel">LogicalUndo</span></pre>
<div class="block">A Logical undo is an undo operation that operates on a different page
                from the page that has the original change.  The reason one would
                need logical undo is when an uncommitted row move from one page to
                another in a nested internal transaction which is committed.  For
                example, an uncommitted insert on a btree may be moved by a later split
                operation to another page, the split operation will have committed.  If
                the insert needs to be rolled back, it can only be found at the new
                page where the split puts it and not at the original page where it is
                inserted. 
                <P>
                The logging and recovery system does not know how to do logical undo.
                Client of the logging system must provide it with a call back function
                so that during undo time (both runtime undo and recovery undo), the
                appropriate page and row can be found so that the logging system can
                apply the log's undo operation.
                <P>
                Any log operation that needs logical undo must implement this
                LogicalUndo interface, which serves the purpose of a callback function
                pointer.  This callback function findUndoInfo is called by log operation
                generateUndo and will be given all the information in the log operation.
                <P>
                FindUndo uses the information in the pageOp to find the correct page
                and record that needs to be rolled back, i.e., a latched page
                (undoPage) and the recordId (undoRID).  It returns the latched
                undoPage, and modifies the pageOp to contain the correct segmentId,
                containerId, pageNumber and recordId etc.  It also need to supply a
                releaseResource() method that the logging system can call to unlatch
                the page and release the container, etc, after the undo has been
                applied.
                <P>
                The logging system will use the information in the undoPackage to put
                together a Compensation operation which has the undoPage number
                and undoRID.  Logical Undo is only called during the generation of a
                CLR, never during recovery redo.
                <P>
                <B>Note: LogicalUndo is a call back function pointer that will be
                written out as part of the log operation, it should not contain any
                non-transient member fields </B>
                <P>
                Details.
                <P>
                LogicalUndo, and LogicalUndoable is the interface used by logical undo
                between the logging system in RawStore and Access.  A log operation
                that needs logical undo should implment LogicalUndoable intead of
                Undoable.  A LogicalUndoable log operation contains a LogicalUndo
                member field, which is a function pointer to an Access function that
                provides the logical undo logic of, say, traversing a btree.  
                <P>
                When called to generateUndo, that LogicalUndoable log operation will
                call LogicalUndo.findUndo instead of relying on the page number and
                recordId that is stored in it during the runtime roll forward
                operation.  <B>The logging system opens the container before it calls
                findUndo, therefore the container where the log operation is applied
                cannot between rollforward and rollback.</B>
                <P>
                In LogicalUndo.findUndo, it can use information stored in
                the LogicalUndoable, such as pageNumber, containerId, to come up with a
                template row.  It can then ask the LogicalUndoable log record
                to restore a row from the log record that fits the template.  Using
                this restored row, LogicalUndo can, e.g., restore the key to the btree
                and traverses the btree.  Once it finds the correct RecordHandle where
                the rollback should go, findUndo should call pageOp.resetRecord and
                return a latched page where the undo should go.
                <P>
                Upon the return of findUndo, the LogicalUndoable log operation should
                have information about the new RecordHandle and the page should be
                return latched.  A compensation operation is then generated with the
                new record location and undoMe is applied on the correct location.
                <P>
                The logging system will unlatch the undoPage when it is done with
                rollback and will close the container.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../../org/apache/derby/iapi/store/raw/LogicalUndoable.html" title="interface in org.apache.derby.iapi.store.raw"><code>LogicalUndoable</code></a>, 
<a href="../../../../../../../org/apache/derby/iapi/store/raw/Undoable.html#generateUndo-org.apache.derby.iapi.store.raw.Transaction-org.apache.derby.iapi.services.io.LimitObjectInput-"><code>Undoable.generateUndo(org.apache.derby.iapi.store.raw.Transaction, org.apache.derby.iapi.services.io.LimitObjectInput)</code></a></dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code><a href="../../../../../../../org/apache/derby/iapi/store/raw/Page.html" title="interface in org.apache.derby.iapi.store.raw">Page</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../../org/apache/derby/iapi/store/access/conglomerate/LogicalUndo.html#findUndo-org.apache.derby.iapi.store.raw.Transaction-org.apache.derby.iapi.store.raw.LogicalUndoable-org.apache.derby.iapi.services.io.LimitObjectInput-">findUndo</a></span>(<a href="../../../../../../../org/apache/derby/iapi/store/raw/Transaction.html" title="interface in org.apache.derby.iapi.store.raw">Transaction</a>&nbsp;transaction,
        <a href="../../../../../../../org/apache/derby/iapi/store/raw/LogicalUndoable.html" title="interface in org.apache.derby.iapi.store.raw">LogicalUndoable</a>&nbsp;pageOp,
        <a href="../../../../../../../org/apache/derby/iapi/services/io/LimitObjectInput.html" title="interface in org.apache.derby.iapi.services.io">LimitObjectInput</a>&nbsp;in)</code>
<div class="block">Find the page and record to undo.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="findUndo-org.apache.derby.iapi.store.raw.Transaction-org.apache.derby.iapi.store.raw.LogicalUndoable-org.apache.derby.iapi.services.io.LimitObjectInput-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>findUndo</h4>
<pre><a href="../../../../../../../org/apache/derby/iapi/store/raw/Page.html" title="interface in org.apache.derby.iapi.store.raw">Page</a>&nbsp;findUndo(<a href="../../../../../../../org/apache/derby/iapi/store/raw/Transaction.html" title="interface in org.apache.derby.iapi.store.raw">Transaction</a>&nbsp;transaction,
              <a href="../../../../../../../org/apache/derby/iapi/store/raw/LogicalUndoable.html" title="interface in org.apache.derby.iapi.store.raw">LogicalUndoable</a>&nbsp;pageOp,
              <a href="../../../../../../../org/apache/derby/iapi/services/io/LimitObjectInput.html" title="interface in org.apache.derby.iapi.services.io">LimitObjectInput</a>&nbsp;in)
       throws <a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a>,
              java.io.IOException</pre>
<div class="block">Find the page and record to undo.  If no logical undo is necessary,
                i.e., row has not moved, then just return the latched page where undo
                should go.  If the record has moved, it has a new recordId on the new
                page, this routine needs to call pageOp.resetRecord with the new
                RecordHandle so that the logging system can update the compensation
                Operation with the new location.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>transaction</code> - the transaction doing the rollback</dd>
<dd><code>pageOp</code> - the page operation that supports logical undo.  This
                                LogicalUndo function pointer is a field of that pageOperation</dd>
<dd><code>in</code> - data stored in the log stream that contains the record data
                                necessary to restore the row.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../../org/apache/derby/iapi/error/StandardException.html" title="class in org.apache.derby.iapi.error">StandardException</a></code> - Standard Derby error policy</dd>
<dd><code>java.io.IOException</code> - Method may read from InputStream</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage">Built on Mon 2017-07-03 23:03:59+0530, from revision Unversioned directory</div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../org/apache/derby/iapi/store/access/conglomerate/ConglomerateFactory.html" title="interface in org.apache.derby.iapi.store.access.conglomerate"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../../org/apache/derby/iapi/store/access/conglomerate/MethodFactory.html" title="interface in org.apache.derby.iapi.store.access.conglomerate"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../index.html?org/apache/derby/iapi/store/access/conglomerate/LogicalUndo.html" target="_top">Frames</a></li>
<li><a href="LogicalUndo.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Apache Derby V10.13 Internals - <i>Copyright &copy; 2004,2016 The Apache Software Foundation. All Rights Reserved.</i></small></p>
</body>
</html>
