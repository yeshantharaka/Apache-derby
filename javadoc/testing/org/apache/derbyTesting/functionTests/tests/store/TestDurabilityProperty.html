<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_66) on Mon Jul 03 23:06:57 IST 2017 -->
<title>TestDurabilityProperty (Apache Derby V10.13 Test Javadoc)</title>
<meta name="date" content="2017-07-03">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="TestDurabilityProperty (Apache Derby V10.13 Test Javadoc)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":9,"i1":9,"i2":9,"i3":9,"i4":9,"i5":9,"i6":9,"i7":9};
var tabs = {65535:["t0","All Methods"],1:["t1","Static Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../org/apache/derbyTesting/functionTests/tests/store/TestDiskHashtable.html" title="class in org.apache.derbyTesting.functionTests.tests.store"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../org/apache/derbyTesting/functionTests/tests/store/TurnsReadOnly.html" title="class in org.apache.derbyTesting.functionTests.tests.store"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/apache/derbyTesting/functionTests/tests/store/TestDurabilityProperty.html" target="_top">Frames</a></li>
<li><a href="TestDurabilityProperty.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.derbyTesting.functionTests.tests.store</div>
<h2 title="Class TestDurabilityProperty" class="title">Class TestDurabilityProperty</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.apache.derbyTesting.functionTests.tests.store.TestDurabilityProperty</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">TestDurabilityProperty</span>
extends java.lang.Object</pre>
<div class="block">This program tests the system when the derby.system.durability property is
 set to 'test'. 
 <BR>
 When the derby.system.durability is set to 'test', the system will not do 
 any sync to the
 disk and the recovery system will not work property. It is provided for
 performance reasons and should ideally only be used when there is no
 requirement for the database to recover.
 <p>
 When set, the system will not do any syncs, the cases namely - no sync of the
 log file at each commit - no sync of the log file before data page is forced
 to disk - no sync of page allocation when file is grown - no sync of data
 writes during checkpoint
 <p>
 That means, when this property is set to 'test',
  - a commit no longer guarantees that the transaction's modification will 
    survive a system crash or
 JVM termination 
 - the database may not recover successfully upon restart 
 - a near full disk at runtime may cause unexpected errors
 - database may be in an inconsistent state
 
 This program tests for 
 1. setting the derby.system.durability=test is actually not
    doing the syncs by timing inserts
 2. check if a warning message exists in derby.log 
 3. read log.ctrl file and check if the flag is set or not
 4. check if the log.ctrl file flag is not overwritten for the case when 
 database booted with derby.system.durability=test set, then shutdown
 and database booted without derby.system.durability=test</div>
<dl>
<dt><span class="simpleTagLabel">Version:</span></dt>
<dd>1.0</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../../org/apache/derbyTesting/functionTests/tests/store/TestDurabilityProperty.html#TestDurabilityProperty--">TestDurabilityProperty</a></span>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">Static Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>static long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/derbyTesting/functionTests/tests/store/TestDurabilityProperty.html#doInserts-java.sql.Connection-boolean-">doInserts</a></span>(java.sql.Connection&nbsp;conn,
         boolean&nbsp;autoCommit)</code>
<div class="block">Note doing inserts in autocommit mode is probably the worst case scenario
 in terms of performance as each commit will involve a flush/sync to disk
 but in case of the derby.system.durability=test mode, the syncs dont 
 happen.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>static boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/derbyTesting/functionTests/tests/store/TestDurabilityProperty.html#isMessageInDerbyLog-java.lang.String-">isMessageInDerbyLog</a></span>(java.lang.String&nbsp;derbyHome)</code>
<div class="block">When derby.system.durability is set, a warning message is written out to
 derby.log indicating that the property is set and that it does not
 guarantee recoverability This test tests if a message is written out to
 derby.log or not</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/derbyTesting/functionTests/tests/store/TestDurabilityProperty.html#main-java.lang.String:A-">main</a></span>(java.lang.String[]&nbsp;args)</code>&nbsp;</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/derbyTesting/functionTests/tests/store/TestDurabilityProperty.html#markerInControlFile-java.lang.String-">markerInControlFile</a></span>(java.lang.String&nbsp;derbyHome)</code>
<div class="block">if database is booted with derby.system.durability=test, 
 a marker is written out into log control
 file to recognize that the database was previously booted in this mode
 Test if the marker byte is set correctly or not.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/derbyTesting/functionTests/tests/store/TestDurabilityProperty.html#markerNotOverwritten-java.lang.String-">markerNotOverwritten</a></span>(java.lang.String&nbsp;derbyHome)</code>
<div class="block">Test for case when database is booted without derby.system.durability=test
 but previously has been booted with the derby.system.durability=test.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/derbyTesting/functionTests/tests/store/TestDurabilityProperty.html#report-java.lang.String-">report</a></span>(java.lang.String&nbsp;msg)</code>
<div class="block">print message</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/derbyTesting/functionTests/tests/store/TestDurabilityProperty.html#testNoSyncs-java.lang.String:A-">testNoSyncs</a></span>(java.lang.String[]&nbsp;args)</code>
<div class="block">Test if derby.system.durability=test property is broken or not.</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>static long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/apache/derbyTesting/functionTests/tests/store/TestDurabilityProperty.html#timeTakenToInsert-java.lang.String-boolean-boolean-">timeTakenToInsert</a></span>(java.lang.String&nbsp;mode,
                 boolean&nbsp;create,
                 boolean&nbsp;autoCommit)</code>
<div class="block">time inserts</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="TestDurabilityProperty--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>TestDurabilityProperty</h4>
<pre>public&nbsp;TestDurabilityProperty()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="main-java.lang.String:A-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>main</h4>
<pre>public static&nbsp;void&nbsp;main(java.lang.String[]&nbsp;args)</pre>
</li>
</ul>
<a name="timeTakenToInsert-java.lang.String-boolean-boolean-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>timeTakenToInsert</h4>
<pre>public static&nbsp;long&nbsp;timeTakenToInsert(java.lang.String&nbsp;mode,
                                     boolean&nbsp;create,
                                     boolean&nbsp;autoCommit)
                              throws java.lang.Exception</pre>
<div class="block">time inserts</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>mode</code> - value for derby.system.durability property</dd>
<dd><code>create</code> - should table be created or not</dd>
<dd><code>autoCommit</code> - whether inserts should happen in autocommit mode or not</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>time taken to do inserts</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd>
</dl>
</li>
</ul>
<a name="doInserts-java.sql.Connection-boolean-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>doInserts</h4>
<pre>public static&nbsp;long&nbsp;doInserts(java.sql.Connection&nbsp;conn,
                             boolean&nbsp;autoCommit)
                      throws java.lang.Exception</pre>
<div class="block">Note doing inserts in autocommit mode is probably the worst case scenario
 in terms of performance as each commit will involve a flush/sync to disk
 but in case of the derby.system.durability=test mode, the syncs dont 
 happen.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd>
</dl>
</li>
</ul>
<a name="isMessageInDerbyLog-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isMessageInDerbyLog</h4>
<pre>public static&nbsp;boolean&nbsp;isMessageInDerbyLog(java.lang.String&nbsp;derbyHome)
                                   throws java.lang.Exception</pre>
<div class="block">When derby.system.durability is set, a warning message is written out to
 derby.log indicating that the property is set and that it does not
 guarantee recoverability This test tests if a message is written out to
 derby.log or not</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd>
</dl>
</li>
</ul>
<a name="markerInControlFile-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>markerInControlFile</h4>
<pre>public static&nbsp;void&nbsp;markerInControlFile(java.lang.String&nbsp;derbyHome)
                                throws java.lang.Exception</pre>
<div class="block">if database is booted with derby.system.durability=test, 
 a marker is written out into log control
 file to recognize that the database was previously booted in this mode
 Test if the marker byte is set correctly or not. See comments in
 org.apache.derby.impl.store.log.LogToFile for IS_DURABILITY_TESTMODE_NO_SYNC_FLAG</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd>
</dl>
</li>
</ul>
<a name="markerNotOverwritten-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>markerNotOverwritten</h4>
<pre>public static&nbsp;void&nbsp;markerNotOverwritten(java.lang.String&nbsp;derbyHome)
                                 throws java.lang.Exception</pre>
<div class="block">Test for case when database is booted without derby.system.durability=test
 but previously has been booted with the derby.system.durability=test. In 
 this scenario,the log control file should still have the marker to say
 that this mode was set previously, and derby.log must also have a warning
 message</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>derbyHome</code> - value of derby.system.home where the database is</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd>
</dl>
</li>
</ul>
<a name="report-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>report</h4>
<pre>public static&nbsp;void&nbsp;report(java.lang.String&nbsp;msg)</pre>
<div class="block">print message</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>msg</code> - to print out</dd>
</dl>
</li>
</ul>
<a name="testNoSyncs-java.lang.String:A-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>testNoSyncs</h4>
<pre>public static&nbsp;void&nbsp;testNoSyncs(java.lang.String[]&nbsp;args)
                        throws java.lang.Exception</pre>
<div class="block">Test if derby.system.durability=test property is broken or not. We time
 inserts for 500 repeated inserts and make some approximate estimations on
 how fast it should be. Since it is a timing based test, there might be
 cases of a really really slow machine in some weird cases where this test
 may have diffs in this part of the test.
 
 So basically to determine if something is wrong, the following is done
 to try best to eliminate issues with slow machines
 1)if inserts with autocommit on is fast enough (an estimated
 bound)
 2)if not, then since no syncs happen , check if time taken to do
 inserts for autocommit on and off are in proximity range 
 3)if 1 and 2 is not satisfied, then check time taken without this mode set
 and with this mode set.
 If they are in proximity range something could be wrong. It
 might be good to check the machine configuration and environment when
 test was running <BR>
 Also note, although it would seem like a solution would be to bump the
 estimated bound to a high limit, this might not help since on a really
 good disk the inserts doing syncs might well be done within the bound and
 thus would not be possible to know if this mode was possibly broken.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage">Built on Mon 2017-07-03 23:03:59+0530, from revision Unversioned directory</div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../org/apache/derbyTesting/functionTests/tests/store/TestDiskHashtable.html" title="class in org.apache.derbyTesting.functionTests.tests.store"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../org/apache/derbyTesting/functionTests/tests/store/TurnsReadOnly.html" title="class in org.apache.derbyTesting.functionTests.tests.store"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/apache/derbyTesting/functionTests/tests/store/TestDurabilityProperty.html" target="_top">Frames</a></li>
<li><a href="TestDurabilityProperty.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Apache Derby V10.13 Internals - <i>Copyright &copy; 2004,2016 The Apache Software Foundation. All Rights Reserved.</i></small></p>
</body>
</html>
